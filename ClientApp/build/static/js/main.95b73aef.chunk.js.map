{"version":3,"sources":["registerServiceWorker.js","actions/editorActions.js","reducers/index.js","reducers/editor.js","icons/arrow-down.svg","icons/toolbar/title.svg","icons/toolbar/bold.svg","icons/toolbar/italic.svg","icons/toolbar/quote.svg","icons/toolbar/code.svg","icons/toolbar/table.svg","icons/toolbar/link.svg","icons/toolbar/img.svg","icons/toolbar/divider.svg","icons/toolbar/ul.svg","icons/toolbar/ol.svg","components/Toolbar/ButtonList.js","components/Toolbar/Buttons.js","components/Toolbar/Toolbar.js","components/Sidebar/Sidebar.js","vendor/Markdown.Converter.js","vendor/Markdown.Editor.js","components/Editor/Editor.js","components/Paper/Paper.js","components/App/App.js","index.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","catch","error","combineReducers","editor","arguments","length","undefined","action","type","_extends","Object","assign","target","i","source","key","prototype","hasOwnProperty","call","apply","this","arrow_down_ref","react_default","a","createElement","d","fill","_ref2","arrow_down_SvgComponent","props","width","height","viewBox","__webpack_require__","p","title_extends","title_ref","bold_extends","bold_ref","italic_extends","italic_ref","quote_extends","quote_ref","code_extends","code_ref","table_extends","table_ref","link_extends","link_ref","img_extends","img_ref","divider_extends","divider_ref","divider_ref2","_ref3","divider_ref4","ul_extends","ul_ref","ol_extends","ol_ref","ButtonList","Icon","title","method","StyledButtons","styled","div","_templateObject","Buttons","map","_ref","index","onClick","doClick","Component","connect","Button","span","Toolbar_templateObject","StyledToolbar","_templateObject2","Wrapper","_templateObject3","Group","_templateObject4","LoginButton","_templateObject5","Toolbar","Toolbar_Buttons","href","concat","process","REACT_APP_API_BASE_URL","Markdown","StyledSidebar","Sidebar_templateObject","Item","Sidebar_templateObject2","hl","Text","Sidebar_templateObject3","mockData","Own files","name","id","highlighted","Other's files","Sidebar","keys","react","_ref4","exports","identity","x","returnFalse","HookCollection","SaveHash","chain","hookname","func","original","Error","text","args","Array","slice","set","addNoop","addFalse","value","get","Converter","options","setOptions","optionsParam","g_urls","g_titles","g_html_blocks","g_list_level","pluginHooks","hooks","_HashHTMLBlocks","replace","hashElement","wholeMatch","m1","blockText","push","makeHtml","_Detab","preConversion","charCodeToReplace","parseInt","String","fromCharCode","_UnescapeSpecialChars","_RunBlockGamut","m2","m3","m4","m5","toLowerCase","_EncodeAmpsAndAngles","_StripLinkDefinitions","postNormalization","postConversion","blockGamutHookCallback","t","doNotUnhash","bq","pre","_DoBlockQuotes","codeblock","nextChar","_EncodeCode","_Outdent","_DoCodeBlocks","_DoLists","_RunSpanGamut","matchFound","h_level","_DoHeaders","preBlockGamut","grafs","split","grafsOut","markerRe","end","str","test","foundAny","join","_FormParagraphs","postBlockGamut","autoLinkRegex","handleTrailingParens","wholematch","plainLinkText","_DoAutoLinks","writeAnchorTag","_DoAnchors","writeImageTag","_DoImages","escapeCharacters_callback","_EncodeBackslashEscapes","tag","escapeCharacters","charAt","_EscapeSpecialCharsWithinTagAttributes","c","_DoCodeSpans","preSpanGamut","_DoItalicsAndBold","postSpanGamut","m6","m7","whole_match","link_text","link_id","url","search","result","_problemUrlChars","offset","charCodeAt","toString","encodeProblemUrlChars","attributeEncode","alt_text","isInsideParagraphlessListItem","whole_list","list","list_type","_ProcessListItems","runup","_listItemMarkers","ol","ul","list_str","marker","re","RegExp","last_item_had_a_double_newline","item","ends_with_double_newline","endCharRegex","lookbehind","protocol","link","parens","level","tail","trailingParens","lastChar","substr","v","spaces","skew","charsToEscape","afterBackslash","regexString","regex","util","position","ui","doc","document","nav","SETTINGS","uaSniffed","isIE","userAgent","isIE_5or6","isOpera","isMac","platform","defaultsStrings","bold","boldexample","italic","italicexample","linkdescription","linkdialog","quote","quoteexample","code","codeexample","image","imagedescription","imagedialog","olist","ulist","litem","heading","headingexample","hr","undo","redo","help","keyStrokes","win","mac","Chunks","PanelCollection","postfix","cm","buttonBar","getElementById","preview","input","TextareaState","panels","isInitialState","stateObj","inputArea","init","before","getRange","CodeMirror","Pos","getCursor","selection","getSelection","after","posFromIndex","Number","MAX_VALUE","setInputAreaSelectionStartEnd","scrollTop","setInputAreaSelection","setSelection","start","scroll","focus","restore","startIndex","startIndexMax","endIndex","endIndexMax","beforeMaxOffset","afterMaxOffset","replaceRange","substring","getChunks","chunk","startTag","endTag","setChunks","PreviewManager","converter","previewRefreshCallback","previewWrapper","timeout","elapsedTime","oldInputText","getDocScrollTop","innerHeight","pageYOffset","documentElement","body","makePreviewHtml","getValue","prevTime","Date","getTime","currTime","pushPreviewHtml","applyTimeout","clearTimeout","delay","setTimeout","refresh","requiresRefresh","processingTime","previewSetter","isFirstTimeFilled","ieSafePreviewSet","parent","parentNode","sibling","nextSibling","removeChild","innerHTML","insertBefore","appendChild","nonSuckyBrowserPreviewSet","emptyTop","getTop","e","previewSet","panel","scrollHeight","clientHeight","setPanelScrollTops","fullTop","scrollBy","on","UIManager","undoManager","previewManager","commandManager","helpOptions","getString","getKey","getStringAndKey","identifier","inputBox","buttons","setUndoRedoButtonStates","setupButton","history","done","undone","that","buttonRow","className","xPosition","makeButton","XShift","textOp","button","style","left","buttonImage","makeSpacer","num","spacer","bindCommand","postProcessing","doLinkOrImage","doList","execute","manager","helpButton","helpButtonImage","isHelp","right","onclick","handler","makeSpritedButtonRow","linkOrImage","setCommandMode","chunks","fixupInputArea","isEnabled","getElementsByTagName","backgroundPosition","onmouseover","onmouseout","onmousedown","activeElement","ieCachedRange","createRange","ieCachedScrollTop","identifierList","eKeys","addKeyMap","addKeyCmd","setButtonState","CommandManager","Editor","markdownConverter","idPostfix","strings","getConverter","run","uiManager","onPreviewRefresh","refreshPreview","findTags","startRegex","endRegex","chunkObj","extendRegExp","trimWhitespace","remove","beforeReplacer","afterReplacer","s","skipLines","nLinesBefore","nLinesAfter","findExtraNewlines","regexText","replacementText","$1","isVisible","elem","getComputedStyle","getPropertyValue","currentStyle","addEvent","event","listener","attachEvent","addEventListener","removeEvent","detachEvent","removeEventListener","fixEolChars","post","flags","pattern","flagsPart","isInner","offsetTop","offsetParent","getHeight","offsetHeight","getWidth","offsetWidth","scrollWidth","getPageSize","innerWidth","scrollMaxY","clientWidth","Math","max","createBackground","background","top","zIndex","filter","opacity","pageSize","scrollLeft","prompt","defaultInputText","callback","dialog","checkEscape","charCode","keyCode","close","isCancel","padding","question","form","onsubmit","margin","cssFloat","textAlign","display","marginLeft","marginRight","okButton","cancelButton","marginTop","createDialog","commandProto","prefixes","unwrap","txt","wrap","len","line","marked","doBold","doBorI","doItalic","nStars","insertText","starsBefore","exec","starsAfter","prevStars","min","whitespace","markup","stripLinkDefs","defsToAdd","totalMatch","newlines","addLinkDef","linkDef","refNumber","defs","addDefNumber","def","getLink","inner","afterInner","refOut","isImage","linkEnteredCallback","querypart","decodeURIComponent","encodeURI","trim","insertImageDialog","insertLinkDialog","doAutoindent","fakeSelection","doBlockquote","doCode","newlinesBefore","newlinesAfter","blankLine","leftOver","lines","inChain","good","replaceBlanksInTags","useBracket","replacement","markdown","postBlockquoteCreation","blanks","hasTextBefore","nLinesBack","nLinesForward","isNumberedList","nextItemsRegex","bullet","getItemPrefix","prefix","getPrefixedItem","itemText","_","hasDigits","nLinesUp","nLinesDown","doHeading","headerLevel","lastMatch","headerLevelToCreate","headerChar","doHorizontalRule","FakeButtonsElement","Editor_templateObject","editorRef","createRef","pagedownConverter","PagedownConverter","pagedownEditor","PagedownEditor","codeMirror","fromTextArea","current","mode","allowAtxHeaderWithoutSpace","highlightFormatting","maxBlockquoteDepth","fencedCodeBlockHighlighting","lineWrapping","setCmInstance","Fragment","ref","mapDispatchToProps","Paper_templateObject","StyledPaper","Paper_templateObject2","Paper","Paper_Wrapper","components_Editor_Editor","GlobalStyle","createGlobalStyle","App_templateObject","App","components_Toolbar_Toolbar","components_Sidebar_Sidebar","components_Paper_Paper","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","rootReducer","applyMiddleware","thunkMiddleware","render","es","components_App_App","URL","origin","fetch","response","status","headers","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.95b73aef.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","export const SET_CM_INSTANCE = 'SET_CM_INSTANCE'\n\nexport const setCmInstance = ({ codeMirror, doClick }) => ({\n\ttype: SET_CM_INSTANCE,\n\teditor: {\n\t\tcodeMirror,\n\t\tdoClick,\n\t},\n})\n","import { combineReducers } from 'redux'\nimport editor from './editor'\n\nexport default combineReducers({\n\teditor,\n})\n","import { SET_CM_INSTANCE } from '../actions/editorActions'\n\nexport default (state = null, action) => {\n\tswitch (action.type) {\n\t\tcase SET_CM_INSTANCE:\n\t\t\treturn action.editor\n\n\t\tdefault:\n\t\t\treturn state\n\t}\n}\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M11 0L12 1L6 7V5L11 0Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M1 0L-1.90735e-06 1L6 7V5L1 0Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 12,\n    height: 7,\n    viewBox: \"0 0 12 7\",\n    fill: \"none\"\n  }, props), _ref, _ref2);\n};\n\nexport default __webpack_public_path__ + \"static/media/arrow-down.b1b39921.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M0 0V3H5.5V15H8.5V3H14V0H0Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 14,\n    height: 15,\n    viewBox: \"0 0 14 15\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/title.01200e3f.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M8.6 6.79C9.57 6.12 10.25 5.02 10.25 4C10.25 1.74 8.5 0 6.25 0H0V14H7.04C9.13 14 10.75 12.3 10.75 10.21C10.75 8.69 9.89 7.39 8.6 6.79ZM3 2.5H6C6.83 2.5 7.5 3.17 7.5 4C7.5 4.83 6.83 5.5 6 5.5H3V2.5ZM6.5 11.5H3V8.5H6.5C7.33 8.5 8 9.17 8 10C8 10.83 7.33 11.5 6.5 11.5Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 11,\n    height: 14,\n    viewBox: \"0 0 11 14\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/bold.52868e47.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M4 0V3H6.21L2.79 11H0V14H8V11H5.79L9.21 3H12V0H4Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 12,\n    height: 14,\n    viewBox: \"0 0 12 14\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/italic.8b131a48.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M1 10H4L6 6V0H0V6H3L1 10ZM9 10H12L14 6V0H8V6H11L9 10Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 14,\n    height: 10,\n    viewBox: \"0 0 14 10\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/quote.b500190f.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M7.4 10.6L2.8 6L7.4 1.4L6 0L0 6L6 12L7.4 10.6ZM12.6 10.6L17.2 6L12.6 1.4L14 0L20 6L14 12L12.6 10.6Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 20,\n    height: 12,\n    viewBox: \"0 0 20 12\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/code.78b4053b.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M0 18H2V16H0V18ZM4 18H6V16H4V18ZM2 4H0V6H2V4ZM0 14H2V12H0V14ZM6 0H4V2H6V0ZM2 0H0V2H2V0ZM14 0H12V2H14V0ZM16 6H18V4H16V6ZM16 0V2H18V0H16ZM12 18H14V16H12V18ZM10 0H8V8H0V10H8V18H10V10H18V8H10V0ZM16 18H18V16H16V18ZM16 14H18V12H16V14Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 18,\n    viewBox: \"0 0 18 18\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/table.dea78394.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M1.9 5C1.9 3.29 3.29 1.9 5 1.9H9V0H5C2.24 0 0 2.24 0 5C0 7.76 2.24 10 5 10H9V8.1H5C3.29 8.1 1.9 6.71 1.9 5ZM6 6H14V4H6V6ZM15 0H11V1.9H15C16.71 1.9 18.1 3.29 18.1 5C18.1 6.71 16.71 8.1 15 8.1H11V10H15C17.76 10 20 7.76 20 5C20 2.24 17.76 0 15 0Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 20,\n    height: 10,\n    viewBox: \"0 0 20 10\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/link.acd546b6.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M18 16V2C18 0.9 17.1 0 16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16ZM5.5 10.5L8 13.51L11.5 9L16 15H2L5.5 10.5Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 18,\n    viewBox: \"0 0 18 18\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/img.664e1d27.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M2 13.5H4.5V12H2V13.5ZM2 16H7.5V14.5H2V16ZM4.5 0H2V1.5H4.5V0ZM15 0H6.5V1.5H15V0ZM9.5 16H14V14.5H9.5V16ZM0 9H18V7H0V9Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M2 2.5H7.5V4H2V2.5Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M6 12H15.5V13.5H6V12Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M9.5 2.5H15.5V4H9.5V2.5Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 16,\n    viewBox: \"0 0 18 16\",\n    fill: \"none\"\n  }, props), _ref, _ref2, _ref3, _ref4);\n};\n\nexport default __webpack_public_path__ + \"static/media/divider.3d434b25.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M2 6.5C1.17 6.5 0.5 7.17 0.5 8C0.5 8.83 1.17 9.5 2 9.5C2.83 9.5 3.5 8.83 3.5 8C3.5 7.17 2.83 6.5 2 6.5ZM2 0.5C1.17 0.5 0.5 1.17 0.5 2C0.5 2.83 1.17 3.5 2 3.5C2.83 3.5 3.5 2.83 3.5 2C3.5 1.17 2.83 0.5 2 0.5ZM2 12.5C1.17 12.5 0.5 13.18 0.5 14C0.5 14.82 1.18 15.5 2 15.5C2.82 15.5 3.5 14.82 3.5 14C3.5 13.18 2.83 12.5 2 12.5ZM5 15H19V13H5V15ZM5 9H19V7H5V9ZM5 1V3H19V1H5Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 19,\n    height: 16,\n    viewBox: \"0 0 19 16\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/ul.512a0d65.svg\";\nexport { SvgComponent as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from 'react';\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M0 13H2V13.5H1V14.5H2V15H0V16H3V12H0V13ZM1 4H2V0H0V1H1V4ZM0 7H1.8L0 9.1V10H3V9H1.2L3 6.9V6H0V7ZM5 1V3H19V1H5ZM5 15H19V13H5V15ZM5 9H19V7H5V9Z\",\n  fill: \"#EEEEEE\"\n});\n\nvar SvgComponent = function SvgComponent(props) {\n  return React.createElement(\"svg\", _extends({\n    width: 19,\n    height: 16,\n    viewBox: \"0 0 19 16\",\n    fill: \"none\"\n  }, props), _ref);\n};\n\nexport default __webpack_public_path__ + \"static/media/ol.0789ebe4.svg\";\nexport { SvgComponent as ReactComponent };","import { ReactComponent as TitleIcon } from '../../icons/toolbar/title.svg'\nimport { ReactComponent as BoldIcon } from '../../icons/toolbar/bold.svg'\nimport { ReactComponent as ItalicIcon } from '../../icons/toolbar/italic.svg'\nimport { ReactComponent as QuoteIcon } from '../../icons/toolbar/quote.svg'\nimport { ReactComponent as CodeIcon } from '../../icons/toolbar/code.svg'\nimport { ReactComponent as TableIcon } from '../../icons/toolbar/table.svg'\nimport { ReactComponent as LinkIcon } from '../../icons/toolbar/link.svg'\nimport { ReactComponent as ImgIcon } from '../../icons/toolbar/img.svg'\nimport { ReactComponent as DividerIcon } from '../../icons/toolbar/divider.svg'\nimport { ReactComponent as UlIcon } from '../../icons/toolbar/ul.svg'\nimport { ReactComponent as OlIcon } from '../../icons/toolbar/ol.svg'\n\nexport default [\n\t{ Icon: TitleIcon, title: 'Heading', method: 'heading' },\n    { Icon: BoldIcon, title: 'Bold', method: 'bold' },\n    { Icon: ItalicIcon, title: 'Italic', method: 'italic' },\n    { Icon: QuoteIcon, title: 'Blockquote', method: 'quote' },\n    { Icon: CodeIcon, title: 'Code', method: 'code' },\n    { Icon: TableIcon, title: 'Table', method: 'table' },\n    { Icon: LinkIcon, title: 'Link', method: 'link' },\n    { Icon: ImgIcon, title: 'Image', method: 'image' },\n    { Icon: DividerIcon , title: 'Divider', method: 'hr'},\n    { Icon: UlIcon, title: 'Unordered list', method: 'ulist' },\n    { Icon: OlIcon, title: 'Ordered list', method: 'olist' },\n]\n","import React, { Component } from 'react'\nimport styled from 'styled-components'\nimport { connect } from 'react-redux'\n\nimport ButtonList from './ButtonList'\n\nconst StyledButtons = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tsvg {\n\t\tmargin: 0 15px;\n\t\tcursor: pointer;\n\t}\n`\n\nclass Buttons extends Component {\n\tcomponentDidMount() {}\n\n\trender() {\n\t\tconst { editor } = this.props\n\n\t\treturn (\n\t\t\t<StyledButtons>\n\t\t\t\t{ButtonList.map(({ Icon, method }, index) => (\n                    <Icon key={index} onClick={() => editor.doClick(method)} fill=\"var(--c-lightgrey-text)\" />\n\t\t\t\t))}\n\t\t\t</StyledButtons>\n\t\t)\n\t}\n}\n\nexport default connect(({ editor }) => ({ editor }))(Buttons)\n","import React from 'react'\nimport styled from 'styled-components'\nimport { ReactComponent as ArrowDownIcon } from '../../icons/arrow-down.svg'\nimport Buttons from './Buttons'\n\nconst Button = styled.span`\n\tcursor: pointer;\n`\n\nconst StyledToolbar = styled.div`\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    background-color: var(--c-darkgrey-bg);\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n`\n\nconst Wrapper = styled.div`\n    width: 100vw;\n    max-width: var(--container-width);\n    height: 60px;\n    display: flex;\n\tjustify-content: space-between;\n`\n\nconst Group = styled.div`\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    color: var(--c-lightgrey-text);\n    font-weight: 200;\n    &:nth-of-type(3n - 1) {\n        display: flex;\n        justify-content: center;\n    }\n    &:nth-of-type(3n) {\n        display: flex;\n        justify-content: flex-end;\n    }\n    svg {\n      margin-left: 15px;\n    }\n`\n\nconst LoginButton = styled.a`\n\tfont-weight: 500;\n\tcolor: var(--c-blue-hl);\n    text-decoration: none;\n`\n\nconst Toolbar = () => (\n    <StyledToolbar>\n        <Wrapper>\n\t\t\t<Group>\n\t\t\t\tLorem Ipsum Dolor <Button><ArrowDownIcon /></Button>\n\t\t\t</Group>\n\t\t\t<Group><Buttons /></Group>\n\t\t\t<Group>\n                <LoginButton href={`${process.env.REACT_APP_API_BASE_URL}/auth/google`}>Login</LoginButton>\n\t\t\t</Group>\n        </Wrapper>\n    </StyledToolbar>\n)\n\nexport default Toolbar\n","import React, { Fragment } from 'react'\nimport styled from 'styled-components'\n\nconst StyledSidebar = styled.div`\n\tmargin-top: 40px;\n\twidth: calc((var(--max-width) - var(--container-width)) / 2);\n    position: fixed;\n    margin-left: 50%;\n    left: calc((var(--max-width) / -2))\n`\n// left: calc((var(--container-width) / -2) - (var(--max-width) - var(--container-width)) / 2)\nconst Item = styled.div`\n\tbackground-color: ${({ hl }) => hl ? 'var(--c-white-hl)' : 'transparent'};\n\tborder-left: ${({ hl }) => hl ? '4px' : 0} solid var(--c-blue-hl);\n\tpadding: 8px 21px;\n\tpadding-left: ${({ hl }) => hl ? '17px' : '21px'};\n\tfont-weight: 200;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tcolor: var(--c-darkgrey-text);\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: black;\n\t}\n`\n\nconst Text = styled.p`\n\tmargin: 50px 0 3px 21px;\n\tfont-weight: 500;\n\tfont-size: .9rem;\n\ttext-transform: uppercase;\n\tcolor: var(--c-grey-text);\n`\n\nconst mockData = {\n\t'Own files': [\n\t\t{ name: 'Lorem Ipsum Dolor', id: 1, highlighted: true },\n\t\t{ name: 'Sit Amet Consectetur', id: 2 },\n\t\t{ name: 'Sed do eiusmod', id: 3 },\n\t\t{ name: 'Tempor ut dolore', id: 4 },\n\t],\n\t'Other\\'s files': [\n\t\t{ name: 'Lorem Ipsum Dolor', id: 1 },\n\t\t{ name: 'Sit Amet Consectetur', id: 2 },\n\t\t{ name: 'Sed do eiusmod', id: 3 },\n\t\t{ name: 'Tempor ut dolore', id: 4 },\n\t],\n}\n\nconst Sidebar = () => (\n\t<StyledSidebar>\n\t\t{Object.keys(mockData).map(key => (\n\t\t\t<Fragment key={key}>\n\t\t\t\t<Text>{key}</Text>\n\t\t\t\t{mockData[key].map(({ name, highlighted, id }) => (\n\t\t\t\t\t<Item key={id} hl={highlighted}>{name}</Item>\n\t\t\t\t))}\n            </Fragment>\n\t\t))}\n\t</StyledSidebar>\n)\n\nexport default Sidebar\n","/* eslint-disable */\n\nvar Markdown;\n\nif (typeof exports === \"object\" && typeof require === \"function\") // we're in a CommonJS (e.g. Node.js) module\n    Markdown = exports;\nelse\n    Markdown = {};\n    \n// The following text is included for historical reasons, but should\n// be taken with a pinch of salt; it's not all true anymore.\n\n//\n// Wherever possible, Showdown is a straight, line-by-line port\n// of the Perl version of Markdown.\n//\n// This is not a normal parser design; it's basically just a\n// series of string substitutions.  It's hard to read and\n// maintain this way,  but keeping Showdown close to the original\n// design makes it easier to port new features.\n//\n// More importantly, Showdown behaves like markdown.pl in most\n// edge cases.  So web applications can do client-side preview\n// in Javascript, and then build identical HTML on the server.\n//\n// This port needs the new RegExp functionality of ECMA 262,\n// 3rd Edition (i.e. Javascript 1.5).  Most modern web browsers\n// should do fine.  Even with the new regular expression features,\n// We do a lot of work to emulate Perl's regex functionality.\n// The tricky changes in this file mostly have the \"attacklab:\"\n// label.  Major or self-explanatory changes don't.\n//\n// Smart diff tools like Araxis Merge will be able to match up\n// this file with markdown.pl in a useful way.  A little tweaking\n// helps: in a copy of markdown.pl, replace \"#\" with \"//\" and\n// replace \"$text\" with \"text\".  Be sure to ignore whitespace\n// and line endings.\n//\n\n\n//\n// Usage:\n//\n//   var text = \"Markdown *rocks*.\";\n//\n//   var converter = new Markdown.Converter();\n//   var html = converter.makeHtml(text);\n//\n//   alert(html);\n//\n// Note: move the sample code to the bottom of this\n// file before uncommenting it.\n//\n\n(function () {\n\n    function identity(x) { return x; }\n    function returnFalse(x) { return false; }\n\n    function HookCollection() { }\n\n    HookCollection.prototype = {\n\n        chain: function (hookname, func) {\n            var original = this[hookname];\n            if (!original)\n                throw new Error(\"unknown hook \" + hookname);\n\n            if (original === identity)\n                this[hookname] = func;\n            else\n                this[hookname] = function (text) {\n                    var args = Array.prototype.slice.call(arguments, 0);\n                    args[0] = original.apply(null, args);\n                    return func.apply(null, args);\n                };\n        },\n        set: function (hookname, func) {\n            if (!this[hookname])\n                throw new Error(\"unknown hook \" + hookname);\n            this[hookname] = func;\n        },\n        addNoop: function (hookname) {\n            this[hookname] = identity;\n        },\n        addFalse: function (hookname) {\n            this[hookname] = returnFalse;\n        }\n    };\n\n    Markdown.HookCollection = HookCollection;\n\n    // g_urls and g_titles allow arbitrary user-entered strings as keys. This\n    // caused an exception (and hence stopped the rendering) when the user entered\n    // e.g. [push] or [__proto__]. Adding a prefix to the actual key prevents this\n    // (since no builtin property starts with \"s_\"). See\n    // http://meta.stackoverflow.com/questions/64655/strange-wmd-bug\n    // (granted, switching from Array() to Object() alone would have left only __proto__\n    // to be a problem)\n    function SaveHash() { }\n    SaveHash.prototype = {\n        set: function (key, value) {\n            this[\"s_\" + key] = value;\n        },\n        get: function (key) {\n            return this[\"s_\" + key];\n        }\n    };\n\n    Markdown.Converter = function () {\n        var options = {};\n        this.setOptions = function(optionsParam) {\n            options = optionsParam;\n        };\n        \n        var pluginHooks = this.hooks = new HookCollection();\n        \n        // given a URL that was encountered by itself (without markup), should return the link text that's to be given to this link\n        pluginHooks.addNoop(\"plainLinkText\");\n        \n        // called with the orignal text as given to makeHtml. The result of this plugin hook is the actual markdown source that will be cooked\n        pluginHooks.addNoop(\"preConversion\");\n        \n        // called with the text once all normalizations have been completed (tabs to spaces, line endings, etc.), but before any conversions have\n        pluginHooks.addNoop(\"postNormalization\");\n        \n        // Called with the text before / after creating block elements like code blocks and lists. Note that this is called recursively\n        // with inner content, e.g. it's called with the full text, and then only with the content of a blockquote. The inner\n        // call will receive outdented text.\n        pluginHooks.addNoop(\"preBlockGamut\");\n        pluginHooks.addNoop(\"postBlockGamut\");\n        \n        // called with the text of a single block element before / after the span-level conversions (bold, code spans, etc.) have been made\n        pluginHooks.addNoop(\"preSpanGamut\");\n        pluginHooks.addNoop(\"postSpanGamut\");\n        \n        // called with the final cooked HTML code. The result of this plugin hook is the actual output of makeHtml\n        pluginHooks.addNoop(\"postConversion\");\n\n        //\n        // Private state of the converter instance:\n        //\n\n        // Global hashes, used by various utility routines\n        var g_urls;\n        var g_titles;\n        var g_html_blocks;\n\n        // Used to track when we're inside an ordered or unordered list\n        // (see _ProcessListItems() for details):\n        var g_list_level;\n\n        this.makeHtml = function (text) {\n\n            //\n            // Main function. The order in which other subs are called here is\n            // essential. Link and image substitutions need to happen before\n            // _EscapeSpecialCharsWithinTagAttributes(), so that any *'s or _'s in the <a>\n            // and <img> tags get encoded.\n            //\n\n            // This will only happen if makeHtml on the same converter instance is called from a plugin hook.\n            // Don't do that.\n            if (g_urls)\n                throw new Error(\"Recursive call to converter.makeHtml\");\n        \n            // Create the private state objects.\n            g_urls = new SaveHash();\n            g_titles = new SaveHash();\n            g_html_blocks = [];\n            g_list_level = 0;\n\n            text = pluginHooks.preConversion(text);\n\n            // attacklab: Replace ~ with ~T\n            // This lets us use tilde as an escape char to avoid md5 hashes\n            // The choice of character is arbitray; anything that isn't\n            // magic in Markdown will work.\n            text = text.replace(/~/g, \"~T\");\n\n            // attacklab: Replace $ with ~D\n            // RegExp interprets $ as a special character\n            // when it's in a replacement string\n            text = text.replace(/\\$/g, \"~D\");\n\n            // Standardize line endings\n            text = text.replace(/\\r\\n/g, \"\\n\"); // DOS to Unix\n            text = text.replace(/\\r/g, \"\\n\"); // Mac to Unix\n\n            // Make sure text begins and ends with a couple of newlines:\n            text = \"\\n\\n\" + text + \"\\n\\n\";\n\n            // Convert all tabs to spaces.\n            text = _Detab(text);\n\n            // Strip any lines consisting only of spaces and tabs.\n            // This makes subsequent regexen easier to write, because we can\n            // match consecutive blank lines with /\\n+/ instead of something\n            // contorted like /[ \\t]*\\n+/ .\n            text = text.replace(/^[ \\t]+$/mg, \"\");\n            \n            text = pluginHooks.postNormalization(text);\n\n            // Turn block-level HTML blocks into hash entries\n            text = _HashHTMLBlocks(text);\n\n            // Strip link definitions, store in hashes.\n            text = _StripLinkDefinitions(text);\n\n            text = _RunBlockGamut(text);\n\n            text = _UnescapeSpecialChars(text);\n\n            // attacklab: Restore dollar signs\n            text = text.replace(/~D/g, \"$$\");\n\n            // attacklab: Restore tildes\n            text = text.replace(/~T/g, \"~\");\n\n            text = pluginHooks.postConversion(text);\n\n            g_html_blocks = g_titles = g_urls = null;\n\n            return text;\n        };\n\n        function _StripLinkDefinitions(text) {\n            //\n            // Strips link definitions from text, stores the URLs and titles in\n            // hash references.\n            //\n\n            // Link defs are in the form: ^[id]: url \"optional title\"\n\n            /*\n            text = text.replace(/\n                ^[ ]{0,3}\\[(.+)\\]:  // id = $1  attacklab: g_tab_width - 1\n                [ \\t]*\n                \\n?                 // maybe *one* newline\n                [ \\t]*\n                <?(\\S+?)>?          // url = $2\n                (?=\\s|$)            // lookahead for whitespace instead of the lookbehind removed below\n                [ \\t]*\n                \\n?                 // maybe one newline\n                [ \\t]*\n                (                   // (potential) title = $3\n                    (\\n*)           // any lines skipped = $4 attacklab: lookbehind removed\n                    [ \\t]+\n                    [\"(]\n                    (.+?)           // title = $5\n                    [\")]\n                    [ \\t]*\n                )?                  // title is optional\n                (?:\\n+|$)\n            /gm, function(){...});\n            */\n\n            text = text.replace(/^[ ]{0,3}\\[(.+)\\]:[ \\t]*\\n?[ \\t]*<?(\\S+?)>?(?=\\s|$)[ \\t]*\\n?[ \\t]*((\\n*)[\"(](.+?)[\")][ \\t]*)?(?:\\n+)/gm,\n                function (wholeMatch, m1, m2, m3, m4, m5) {\n                    m1 = m1.toLowerCase();\n                    g_urls.set(m1, _EncodeAmpsAndAngles(m2));  // Link IDs are case-insensitive\n                    if (m4) {\n                        // Oops, found blank lines, so it's not a title.\n                        // Put back the parenthetical statement we stole.\n                        return m3;\n                    } else if (m5) {\n                        g_titles.set(m1, m5.replace(/\"/g, \"&quot;\"));\n                    }\n\n                    // Completely remove the definition from the text\n                    return \"\";\n                }\n            );\n\n            return text;\n        }\n\n        function _HashHTMLBlocks(text) {\n\n            // Hashify HTML blocks:\n            // We only want to do this for block-level HTML tags, such as headers,\n            // lists, and tables. That's because we still want to wrap <p>s around\n            // \"paragraphs\" that are wrapped in non-block-level tags, such as anchors,\n            // phrase emphasis, and spans. The list of tags we're looking for is\n            // hard-coded:\n            var block_tags_a = \"p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del\"\n            var block_tags_b = \"p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math\"\n\n            // First, look for nested blocks, e.g.:\n            //   <div>\n            //     <div>\n            //     tags for inner block must be indented.\n            //     </div>\n            //   </div>\n            //\n            // The outermost tags must start at the left margin for this to match, and\n            // the inner nested divs must be indented.\n            // We need to do this before the next, more liberal match, because the next\n            // match will start at the first `<div>` and stop at the first `</div>`.\n\n            // attacklab: This regex can be expensive when it fails.\n\n            /*\n            text = text.replace(/\n                (                       // save in $1\n                    ^                   // start of line  (with /m)\n                    <($block_tags_a)    // start tag = $2\n                    \\b                  // word break\n                                        // attacklab: hack around khtml/pcre bug...\n                    [^\\r]*?\\n           // any number of lines, minimally matching\n                    </\\2>               // the matching end tag\n                    [ \\t]*              // trailing spaces/tabs\n                    (?=\\n+)             // followed by a newline\n                )                       // attacklab: there are sentinel newlines at end of document\n            /gm,function(){...}};\n            */\n            text = text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\\b[^\\r]*?\\n<\\/\\2>[ \\t]*(?=\\n+))/gm, hashElement);\n\n            //\n            // Now match more liberally, simply from `\\n<tag>` to `</tag>\\n`\n            //\n\n            /*\n            text = text.replace(/\n                (                       // save in $1\n                    ^                   // start of line  (with /m)\n                    <($block_tags_b)    // start tag = $2\n                    \\b                  // word break\n                                        // attacklab: hack around khtml/pcre bug...\n                    [^\\r]*?             // any number of lines, minimally matching\n                    .*</\\2>             // the matching end tag\n                    [ \\t]*              // trailing spaces/tabs\n                    (?=\\n+)             // followed by a newline\n                )                       // attacklab: there are sentinel newlines at end of document\n            /gm,function(){...}};\n            */\n            text = text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\\b[^\\r]*?.*<\\/\\2>[ \\t]*(?=\\n+)\\n)/gm, hashElement);\n\n            // Special case just for <hr />. It was easier to make a special case than\n            // to make the other regex more complicated.  \n\n            /*\n            text = text.replace(/\n                \\n                  // Starting after a blank line\n                [ ]{0,3}\n                (                   // save in $1\n                    (<(hr)          // start tag = $2\n                        \\b          // word break\n                        ([^<>])*?\n                    \\/?>)           // the matching end tag\n                    [ \\t]*\n                    (?=\\n{2,})      // followed by a blank line\n                )\n            /g,hashElement);\n            */\n            text = text.replace(/\\n[ ]{0,3}((<(hr)\\b([^<>])*?\\/?>)[ \\t]*(?=\\n{2,}))/g, hashElement);\n\n            // Special case for standalone HTML comments:\n\n            /*\n            text = text.replace(/\n                \\n\\n                                            // Starting after a blank line\n                [ ]{0,3}                                        // attacklab: g_tab_width - 1\n                (                                               // save in $1\n                    <!\n                    (--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)   // see http://www.w3.org/TR/html-markup/syntax.html#comments and http://meta.stackoverflow.com/q/95256\n                    >\n                    [ \\t]*\n                    (?=\\n{2,})                                  // followed by a blank line\n                )\n            /g,hashElement);\n            */\n            text = text.replace(/\\n\\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \\t]*(?=\\n{2,}))/g, hashElement);\n\n            // PHP and ASP-style processor instructions (<?...?> and <%...%>)\n\n            /*\n            text = text.replace(/\n                (?:\n                    \\n\\n            // Starting after a blank line\n                )\n                (                   // save in $1\n                    [ ]{0,3}        // attacklab: g_tab_width - 1\n                    (?:\n                        <([?%])     // $2\n                        [^\\r]*?\n                        \\2>\n                    )\n                    [ \\t]*\n                    (?=\\n{2,})      // followed by a blank line\n                )\n            /g,hashElement);\n            */\n            text = text.replace(/(?:\\n\\n)([ ]{0,3}(?:<([?%])[^\\r]*?\\2>)[ \\t]*(?=\\n{2,}))/g, hashElement);\n\n            return text;\n        }\n\n        function hashElement(wholeMatch, m1) {\n            var blockText = m1;\n\n            // Undo double lines\n            blockText = blockText.replace(/^\\n+/, \"\");\n\n            // strip trailing blank lines\n            blockText = blockText.replace(/\\n+$/g, \"\");\n\n            // Replace the element text with a marker (\"~KxK\" where x is its key)\n            blockText = \"\\n\\n~K\" + (g_html_blocks.push(blockText) - 1) + \"K\\n\\n\";\n\n            return blockText;\n        }\n        \n        var blockGamutHookCallback = function (t) { return _RunBlockGamut(t); }\n\n        function _RunBlockGamut(text, doNotUnhash) {\n            //\n            // These are all the transformations that form block-level\n            // tags like paragraphs, headers, and list items.\n            //\n            \n            text = pluginHooks.preBlockGamut(text, blockGamutHookCallback);\n            \n            text = _DoHeaders(text);\n\n            // Do Horizontal Rules:\n            var replacement = \"<hr />\\n\";\n            text = text.replace(/^[ ]{0,2}([ ]?\\*[ ]?){3,}[ \\t]*$/gm, replacement);\n            text = text.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \\t]*$/gm, replacement);\n            text = text.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \\t]*$/gm, replacement);\n\n            text = _DoLists(text);\n            text = _DoCodeBlocks(text);\n            text = _DoBlockQuotes(text);\n            \n            text = pluginHooks.postBlockGamut(text, blockGamutHookCallback);\n\n            // We already ran _HashHTMLBlocks() before, in Markdown(), but that\n            // was to escape raw HTML in the original Markdown source. This time,\n            // we're escaping the markup we've just created, so that we don't wrap\n            // <p> tags around block-level tags.\n            text = _HashHTMLBlocks(text);\n            text = _FormParagraphs(text, doNotUnhash);\n\n            return text;\n        }\n\n        function _RunSpanGamut(text) {\n            //\n            // These are all the transformations that occur *within* block-level\n            // tags like paragraphs, headers, and list items.\n            //\n\n            text = pluginHooks.preSpanGamut(text);\n            \n            text = _DoCodeSpans(text);\n            text = _EscapeSpecialCharsWithinTagAttributes(text);\n            text = _EncodeBackslashEscapes(text);\n\n            // Process anchor and image tags. Images must come first,\n            // because ![foo][f] looks like an anchor.\n            text = _DoImages(text);\n            text = _DoAnchors(text);\n\n            // Make links out of things like `<http://example.com/>`\n            // Must come after _DoAnchors(), because you can use < and >\n            // delimiters in inline links like [this](<url>).\n            text = _DoAutoLinks(text);\n            \n            text = text.replace(/~P/g, \"://\"); // put in place to prevent autolinking; reset now\n            \n            text = _EncodeAmpsAndAngles(text);\n            text = options._DoItalicsAndBold ? options._DoItalicsAndBold(text) : _DoItalicsAndBold(text);\n\n            // Do hard breaks:\n            text = text.replace(/  +\\n/g, \" <br>\\n\");\n            \n            text = pluginHooks.postSpanGamut(text);\n\n            return text;\n        }\n\n        function _EscapeSpecialCharsWithinTagAttributes(text) {\n            //\n            // Within tags -- meaning between < and > -- encode [\\ ` * _] so they\n            // don't conflict with their use in Markdown for code, italics and strong.\n            //\n\n            // Build a regex to find HTML tags and comments.  See Friedl's \n            // \"Mastering Regular Expressions\", 2nd Ed., pp. 200-201.\n\n            // SE: changed the comment part of the regex\n\n            var regex = /(<[a-z\\/!$](\"[^\"]*\"|'[^']*'|[^'\">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;\n\n            text = text.replace(regex, function (wholeMatch) {\n                var tag = wholeMatch.replace(/(.)<\\/?code>(?=.)/g, \"$1`\");\n                tag = escapeCharacters(tag, wholeMatch.charAt(1) == \"!\" ? \"\\\\`*_/\" : \"\\\\`*_\"); // also escape slashes in comments to prevent autolinking there -- http://meta.stackoverflow.com/questions/95987\n                return tag;\n            });\n\n            return text;\n        }\n\n        function _DoAnchors(text) {\n            //\n            // Turn Markdown link shortcuts into XHTML <a> tags.\n            //\n            //\n            // First, handle reference-style links: [link text] [id]\n            //\n\n            /*\n            text = text.replace(/\n                (                           // wrap whole match in $1\n                    \\[\n                    (\n                        (?:\n                            \\[[^\\]]*\\]      // allow brackets nested one level\n                            |\n                            [^\\[]           // or anything else\n                        )*\n                    )\n                    \\]\n\n                    [ ]?                    // one optional space\n                    (?:\\n[ ]*)?             // one optional newline followed by spaces\n\n                    \\[\n                    (.*?)                   // id = $3\n                    \\]\n                )\n                ()()()()                    // pad remaining backreferences\n            /g, writeAnchorTag);\n            */\n            text = text.replace(/(\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\][ ]?(?:\\n[ ]*)?\\[(.*?)\\])()()()()/g, writeAnchorTag);\n\n            //\n            // Next, inline-style links: [link text](url \"optional title\")\n            //\n\n            /*\n            text = text.replace(/\n                (                           // wrap whole match in $1\n                    \\[\n                    (\n                        (?:\n                            \\[[^\\]]*\\]      // allow brackets nested one level\n                            |\n                            [^\\[\\]]         // or anything else\n                        )*\n                    )\n                    \\]\n                    \\(                      // literal paren\n                    [ \\t]*\n                    ()                      // no id, so leave $3 empty\n                    <?(                     // href = $4\n                        (?:\n                            \\([^)]*\\)       // allow one level of (correctly nested) parens (think MSDN)\n                            |\n                            [^()\\s]\n                        )*?\n                    )>?                \n                    [ \\t]*\n                    (                       // $5\n                        (['\"])              // quote char = $6\n                        (.*?)               // Title = $7\n                        \\6                  // matching quote\n                        [ \\t]*              // ignore any spaces/tabs between closing quote and )\n                    )?                      // title is optional\n                    \\)\n                )\n            /g, writeAnchorTag);\n            */\n\n            text = text.replace(/(\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\]\\([ \\t]*()<?((?:\\([^)]*\\)|[^()\\s])*?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g, writeAnchorTag);\n\n            //\n            // Last, handle reference-style shortcuts: [link text]\n            // These must come last in case you've also got [link test][1]\n            // or [link test](/foo)\n            //\n\n            /*\n            text = text.replace(/\n                (                   // wrap whole match in $1\n                    \\[\n                    ([^\\[\\]]+)      // link text = $2; can't contain '[' or ']'\n                    \\]\n                )\n                ()()()()()          // pad rest of backreferences\n            /g, writeAnchorTag);\n            */\n            text = text.replace(/(\\[([^\\[\\]]+)\\])()()()()()/g, writeAnchorTag);\n\n            return text;\n        }\n\n        function writeAnchorTag(wholeMatch, m1, m2, m3, m4, m5, m6, m7) {\n            if (m7 == undefined) m7 = \"\";\n            var whole_match = m1;\n            var link_text = m2.replace(/:\\/\\//g, \"~P\"); // to prevent auto-linking withing the link. will be converted back after the auto-linker runs\n            var link_id = m3.toLowerCase();\n            var url = m4;\n            var title = m7;\n\n            if (url == \"\") {\n                if (link_id == \"\") {\n                    // lower-case and turn embedded newlines into spaces\n                    link_id = link_text.toLowerCase().replace(/ ?\\n/g, \" \");\n                }\n                url = \"#\" + link_id;\n\n                if (g_urls.get(link_id) != undefined) {\n                    url = g_urls.get(link_id);\n                    if (g_titles.get(link_id) != undefined) {\n                        title = g_titles.get(link_id);\n                    }\n                }\n                else {\n                    if (whole_match.search(/\\(\\s*\\)$/m) > -1) {\n                        // Special case for explicit empty url\n                        url = \"\";\n                    } else {\n                        return whole_match;\n                    }\n                }\n            }\n            url = encodeProblemUrlChars(url);\n            url = escapeCharacters(url, \"*_\");\n            var result = \"<a href=\\\"\" + url + \"\\\"\";\n\n            if (title != \"\") {\n                title = attributeEncode(title);\n                title = escapeCharacters(title, \"*_\");\n                result += \" title=\\\"\" + title + \"\\\"\";\n            }\n\n            result += \">\" + link_text + \"</a>\";\n\n            return result;\n        }\n\n        function _DoImages(text) {\n            //\n            // Turn Markdown image shortcuts into <img> tags.\n            //\n\n            //\n            // First, handle reference-style labeled images: ![alt text][id]\n            //\n\n            /*\n            text = text.replace(/\n                (                   // wrap whole match in $1\n                    !\\[\n                    (.*?)           // alt text = $2\n                    \\]\n\n                    [ ]?            // one optional space\n                    (?:\\n[ ]*)?     // one optional newline followed by spaces\n\n                    \\[\n                    (.*?)           // id = $3\n                    \\]\n                )\n                ()()()()            // pad rest of backreferences\n            /g, writeImageTag);\n            */\n            text = text.replace(/(!\\[(.*?)\\][ ]?(?:\\n[ ]*)?\\[(.*?)\\])()()()()/g, writeImageTag);\n\n            //\n            // Next, handle inline images:  ![alt text](url \"optional title\")\n            // Don't forget: encode * and _\n\n            /*\n            text = text.replace(/\n                (                   // wrap whole match in $1\n                    !\\[\n                    (.*?)           // alt text = $2\n                    \\]\n                    \\s?             // One optional whitespace character\n                    \\(              // literal paren\n                    [ \\t]*\n                    ()              // no id, so leave $3 empty\n                    <?(\\S+?)>?      // src url = $4\n                    [ \\t]*\n                    (               // $5\n                        (['\"])      // quote char = $6\n                        (.*?)       // title = $7\n                        \\6          // matching quote\n                        [ \\t]*\n                    )?              // title is optional\n                    \\)\n                )\n            /g, writeImageTag);\n            */\n            text = text.replace(/(!\\[(.*?)\\]\\s?\\([ \\t]*()<?(\\S+?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g, writeImageTag);\n\n            return text;\n        }\n        \n        function attributeEncode(text) {\n            // unconditionally replace angle brackets here -- what ends up in an attribute (e.g. alt or title)\n            // never makes sense to have verbatim HTML in it (and the sanitizer would totally break it)\n            return text.replace(/>/g, \"&gt;\").replace(/</g, \"&lt;\").replace(/\"/g, \"&quot;\");\n        }\n\n        function writeImageTag(wholeMatch, m1, m2, m3, m4, m5, m6, m7) {\n            var whole_match = m1;\n            var alt_text = m2;\n            var link_id = m3.toLowerCase();\n            var url = m4;\n            var title = m7;\n\n            if (!title) title = \"\";\n\n            if (url == \"\") {\n                if (link_id == \"\") {\n                    // lower-case and turn embedded newlines into spaces\n                    link_id = alt_text.toLowerCase().replace(/ ?\\n/g, \" \");\n                }\n                url = \"#\" + link_id;\n\n                if (g_urls.get(link_id) != undefined) {\n                    url = g_urls.get(link_id);\n                    if (g_titles.get(link_id) != undefined) {\n                        title = g_titles.get(link_id);\n                    }\n                }\n                else {\n                    return whole_match;\n                }\n            }\n            \n            alt_text = escapeCharacters(attributeEncode(alt_text), \"*_[]()\");\n            url = escapeCharacters(url, \"*_\");\n            var result = \"<img src=\\\"\" + url + \"\\\" alt=\\\"\" + alt_text + \"\\\"\";\n\n            // attacklab: Markdown.pl adds empty title attributes to images.\n            // Replicate this bug.\n\n            //if (title != \"\") {\n            title = attributeEncode(title);\n            title = escapeCharacters(title, \"*_\");\n            result += \" title=\\\"\" + title + \"\\\"\";\n            //}\n\n            result += \" />\";\n\n            return result;\n        }\n\n        function _DoHeaders(text) {\n\n            // Setext-style headers:\n            //  Header 1\n            //  ========\n            //  \n            //  Header 2\n            //  --------\n            //\n            text = text.replace(/^(.+)[ \\t]*\\n=+[ \\t]*\\n+/gm,\n                function (wholeMatch, m1) { return \"<h1>\" + _RunSpanGamut(m1) + \"</h1>\\n\\n\"; }\n            );\n\n            text = text.replace(/^(.+)[ \\t]*\\n-+[ \\t]*\\n+/gm,\n                function (matchFound, m1) { return \"<h2>\" + _RunSpanGamut(m1) + \"</h2>\\n\\n\"; }\n            );\n\n            // atx-style headers:\n            //  # Header 1\n            //  ## Header 2\n            //  ## Header 2 with closing hashes ##\n            //  ...\n            //  ###### Header 6\n            //\n\n            /*\n            text = text.replace(/\n                ^(\\#{1,6})      // $1 = string of #'s\n                [ \\t]*\n                (.+?)           // $2 = Header text\n                [ \\t]*\n                \\#*             // optional closing #'s (not counted)\n                \\n+\n            /gm, function() {...});\n            */\n\n            text = text.replace(/^(\\#{1,6})[ \\t]*(.+?)[ \\t]*\\#*\\n+/gm,\n                function (wholeMatch, m1, m2) {\n                    var h_level = m1.length;\n                    return \"<h\" + h_level + \">\" + _RunSpanGamut(m2) + \"</h\" + h_level + \">\\n\\n\";\n                }\n            );\n\n            return text;\n        }\n\n        function _DoLists(text, isInsideParagraphlessListItem) {\n            //\n            // Form HTML ordered (numbered) and unordered (bulleted) lists.\n            //\n\n            // attacklab: add sentinel to hack around khtml/safari bug:\n            // http://bugs.webkit.org/show_bug.cgi?id=11231\n            text += \"~0\";\n\n            // Re-usable pattern to match any entirel ul or ol list:\n\n            /*\n            var whole_list = /\n                (                                   // $1 = whole list\n                    (                               // $2\n                        [ ]{0,3}                    // attacklab: g_tab_width - 1\n                        ([*+-]|\\d+[.])              // $3 = first list item marker\n                        [ \\t]+\n                    )\n                    [^\\r]+?\n                    (                               // $4\n                        ~0                          // sentinel for workaround; should be $\n                        |\n                        \\n{2,}\n                        (?=\\S)\n                        (?!                         // Negative lookahead for another list item marker\n                            [ \\t]*\n                            (?:[*+-]|\\d+[.])[ \\t]+\n                        )\n                    )\n                )\n            /g\n            */\n            var whole_list = /^(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(~0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/gm;\n\n            if (g_list_level) {\n                text = text.replace(whole_list, function (wholeMatch, m1, m2) {\n                    var list = m1;\n                    var list_type = (m2.search(/[*+-]/g) > -1) ? \"ul\" : \"ol\";\n\n                    var result = _ProcessListItems(list, list_type, isInsideParagraphlessListItem);\n\n                    // Trim any trailing whitespace, to put the closing `</$list_type>`\n                    // up on the preceding line, to get it past the current stupid\n                    // HTML block parser. This is a hack to work around the terrible\n                    // hack that is the HTML block parser.\n                    result = result.replace(/\\s+$/, \"\");\n                    result = \"<\" + list_type + \">\" + result + \"</\" + list_type + \">\\n\";\n                    return result;\n                });\n            } else {\n                whole_list = /(\\n\\n|^\\n?)(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(~0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/g;\n                text = text.replace(whole_list, function (wholeMatch, m1, m2, m3) {\n                    var runup = m1;\n                    var list = m2;\n\n                    var list_type = (m3.search(/[*+-]/g) > -1) ? \"ul\" : \"ol\";\n                    var result = _ProcessListItems(list, list_type);\n                    result = runup + \"<\" + list_type + \">\\n\" + result + \"</\" + list_type + \">\\n\";\n                    return result;\n                });\n            }\n\n            // attacklab: strip sentinel\n            text = text.replace(/~0/, \"\");\n\n            return text;\n        }\n\n        var _listItemMarkers = { ol: \"\\\\d+[.]\", ul: \"[*+-]\" };\n\n        function _ProcessListItems(list_str, list_type, isInsideParagraphlessListItem) {\n            //\n            //  Process the contents of a single ordered or unordered list, splitting it\n            //  into individual list items.\n            //\n            //  list_type is either \"ul\" or \"ol\".\n\n            // The $g_list_level global keeps track of when we're inside a list.\n            // Each time we enter a list, we increment it; when we leave a list,\n            // we decrement. If it's zero, we're not in a list anymore.\n            //\n            // We do this because when we're not inside a list, we want to treat\n            // something like this:\n            //\n            //    I recommend upgrading to version\n            //    8. Oops, now this line is treated\n            //    as a sub-list.\n            //\n            // As a single paragraph, despite the fact that the second line starts\n            // with a digit-period-space sequence.\n            //\n            // Whereas when we're inside a list (or sub-list), that line will be\n            // treated as the start of a sub-list. What a kludge, huh? This is\n            // an aspect of Markdown's syntax that's hard to parse perfectly\n            // without resorting to mind-reading. Perhaps the solution is to\n            // change the syntax rules such that sub-lists must start with a\n            // starting cardinal number; e.g. \"1.\" or \"a.\".\n\n            g_list_level++;\n\n            // trim trailing blank lines:\n            list_str = list_str.replace(/\\n{2,}$/, \"\\n\");\n\n            // attacklab: add sentinel to emulate \\z\n            list_str += \"~0\";\n\n            // In the original attacklab showdown, list_type was not given to this function, and anything\n            // that matched /[*+-]|\\d+[.]/ would just create the next <li>, causing this mismatch:\n            //\n            //  Markdown          rendered by WMD        rendered by MarkdownSharp\n            //  ------------------------------------------------------------------\n            //  1. first          1. first               1. first\n            //  2. second         2. second              2. second\n            //  - third           3. third                   * third\n            //\n            // We changed this to behave identical to MarkdownSharp. This is the constructed RegEx,\n            // with {MARKER} being one of \\d+[.] or [*+-], depending on list_type:\n        \n            /*\n            list_str = list_str.replace(/\n                (^[ \\t]*)                       // leading whitespace = $1\n                ({MARKER}) [ \\t]+               // list marker = $2\n                ([^\\r]+?                        // list item text   = $3\n                    (\\n+)\n                )\n                (?=\n                    (~0 | \\2 ({MARKER}) [ \\t]+)\n                )\n            /gm, function(){...});\n            */\n\n            var marker = _listItemMarkers[list_type];\n            var re = new RegExp(\"(^[ \\\\t]*)(\" + marker + \")[ \\\\t]+([^\\\\r]+?(\\\\n+))(?=(~0|\\\\1(\" + marker + \")[ \\\\t]+))\", \"gm\");\n            var last_item_had_a_double_newline = false;\n            list_str = list_str.replace(re,\n                function (wholeMatch, m1, m2, m3) {\n                    var item = m3;\n                    var leading_space = m1;\n                    var ends_with_double_newline = /\\n\\n$/.test(item);\n                    var contains_double_newline = ends_with_double_newline || item.search(/\\n{2,}/) > -1;\n\n                    if (contains_double_newline || last_item_had_a_double_newline) {\n                        item = _RunBlockGamut(_Outdent(item), /* doNotUnhash = */true);\n                    }\n                    else {\n                        // Recursion for sub-lists:\n                        item = _DoLists(_Outdent(item), /* isInsideParagraphlessListItem= */ true);\n                        item = item.replace(/\\n$/, \"\"); // chomp(item)\n                        if (!isInsideParagraphlessListItem) // only the outer-most item should run this, otherwise it's run multiple times for the inner ones\n                            item = _RunSpanGamut(item);\n                    }\n                    last_item_had_a_double_newline = ends_with_double_newline;\n                    return \"<li>\" + item + \"</li>\\n\";\n                }\n            );\n\n            // attacklab: strip sentinel\n            list_str = list_str.replace(/~0/g, \"\");\n\n            g_list_level--;\n            return list_str;\n        }\n\n        function _DoCodeBlocks(text) {\n            //\n            //  Process Markdown `<pre><code>` blocks.\n            //  \n\n            /*\n            text = text.replace(/\n                (?:\\n\\n|^)\n                (                               // $1 = the code block -- one or more lines, starting with a space/tab\n                    (?:\n                        (?:[ ]{4}|\\t)           // Lines must start with a tab or a tab-width of spaces - attacklab: g_tab_width\n                        .*\\n+\n                    )+\n                )\n                (\\n*[ ]{0,3}[^ \\t\\n]|(?=~0))    // attacklab: g_tab_width\n            /g ,function(){...});\n            */\n\n            // attacklab: sentinel workarounds for lack of \\A and \\Z, safari\\khtml bug\n            text += \"~0\";\n\n            text = text.replace(/(?:\\n\\n|^\\n?)((?:(?:[ ]{4}|\\t).*\\n+)+)(\\n*[ ]{0,3}[^ \\t\\n]|(?=~0))/g,\n                function (wholeMatch, m1, m2) {\n                    var codeblock = m1;\n                    var nextChar = m2;\n\n                    codeblock = _EncodeCode(_Outdent(codeblock));\n                    codeblock = _Detab(codeblock);\n                    codeblock = codeblock.replace(/^\\n+/g, \"\"); // trim leading newlines\n                    codeblock = codeblock.replace(/\\n+$/g, \"\"); // trim trailing whitespace\n\n                    codeblock = \"<pre><code>\" + codeblock + \"\\n</code></pre>\";\n\n                    return \"\\n\\n\" + codeblock + \"\\n\\n\" + nextChar;\n                }\n            );\n\n            // attacklab: strip sentinel\n            text = text.replace(/~0/, \"\");\n\n            return text;\n        }\n\n        function hashBlock(text) {\n            text = text.replace(/(^\\n+|\\n+$)/g, \"\");\n            return \"\\n\\n~K\" + (g_html_blocks.push(text) - 1) + \"K\\n\\n\";\n        }\n\n        function _DoCodeSpans(text) {\n            //\n            // * Backtick quotes are used for <code></code> spans.\n            // \n            // * You can use multiple backticks as the delimiters if you want to\n            //   include literal backticks in the code span. So, this input:\n            //     \n            //      Just type ``foo `bar` baz`` at the prompt.\n            //     \n            //   Will translate to:\n            //     \n            //      <p>Just type <code>foo `bar` baz</code> at the prompt.</p>\n            //     \n            //   There's no arbitrary limit to the number of backticks you\n            //   can use as delimters. If you need three consecutive backticks\n            //   in your code, use four for delimiters, etc.\n            //\n            // * You can use spaces to get literal backticks at the edges:\n            //     \n            //      ... type `` `bar` `` ...\n            //     \n            //   Turns to:\n            //     \n            //      ... type <code>`bar`</code> ...\n            //\n\n            /*\n            text = text.replace(/\n                (^|[^\\\\])       // Character before opening ` can't be a backslash\n                (`+)            // $2 = Opening run of `\n                (               // $3 = The code block\n                    [^\\r]*?\n                    [^`]        // attacklab: work around lack of lookbehind\n                )\n                \\2              // Matching closer\n                (?!`)\n            /gm, function(){...});\n            */\n\n            text = text.replace(/(^|[^\\\\])(`+)([^\\r]*?[^`])\\2(?!`)/gm,\n                function (wholeMatch, m1, m2, m3, m4) {\n                    var c = m3;\n                    c = c.replace(/^([ \\t]*)/g, \"\"); // leading whitespace\n                    c = c.replace(/[ \\t]*$/g, \"\"); // trailing whitespace\n                    c = _EncodeCode(c);\n                    c = c.replace(/:\\/\\//g, \"~P\"); // to prevent auto-linking. Not necessary in code *blocks*, but in code spans. Will be converted back after the auto-linker runs.\n                    return m1 + \"<code>\" + c + \"</code>\";\n                }\n            );\n\n            return text;\n        }\n\n        function _EncodeCode(text) {\n            //\n            // Encode/escape certain characters inside Markdown code runs.\n            // The point is that in code, these characters are literals,\n            // and lose their special Markdown meanings.\n            //\n            // Encode all ampersands; HTML entities are not\n            // entities within a Markdown code span.\n            text = text.replace(/&/g, \"&amp;\");\n\n            // Do the angle bracket song and dance:\n            text = text.replace(/</g, \"&lt;\");\n            text = text.replace(/>/g, \"&gt;\");\n\n            // Now, escape characters that are magic in Markdown:\n            text = escapeCharacters(text, \"\\*_{}[]\\\\\", false);\n\n            // jj the line above breaks this:\n            //---\n\n            //* Item\n\n            //   1. Subitem\n\n            //            special char: *\n            //---\n\n            return text;\n        }\n\n        function _DoItalicsAndBold(text) {\n\n            // <strong> must go first:\n            text = text.replace(/([\\W_]|^)(\\*\\*|__)(?=\\S)([^\\r]*?\\S[\\*_]*)\\2([\\W_]|$)/g,\n            \"$1<strong>$3</strong>$4\");\n\n            text = text.replace(/([\\W_]|^)(\\*|_)(?=\\S)([^\\r\\*_]*?\\S)\\2([\\W_]|$)/g,\n            \"$1<em>$3</em>$4\");\n\n            return text;\n        }\n\n        function _DoBlockQuotes(text) {\n\n            /*\n            text = text.replace(/\n                (                           // Wrap whole match in $1\n                    (\n                        ^[ \\t]*>[ \\t]?      // '>' at the start of a line\n                        .+\\n                // rest of the first line\n                        (.+\\n)*             // subsequent consecutive lines\n                        \\n*                 // blanks\n                    )+\n                )\n            /gm, function(){...});\n            */\n\n            text = text.replace(/((^[ \\t]*>[ \\t]?.+\\n(.+\\n)*\\n*)+)/gm,\n                function (wholeMatch, m1) {\n                    var bq = m1;\n\n                    // attacklab: hack around Konqueror 3.5.4 bug:\n                    // \"----------bug\".replace(/^-/g,\"\") == \"bug\"\n\n                    bq = bq.replace(/^[ \\t]*>[ \\t]?/gm, \"~0\"); // trim one level of quoting\n\n                    // attacklab: clean up hack\n                    bq = bq.replace(/~0/g, \"\");\n\n                    bq = bq.replace(/^[ \\t]+$/gm, \"\");     // trim whitespace-only lines\n                    bq = _RunBlockGamut(bq);             // recurse\n\n                    bq = bq.replace(/(^|\\n)/g, \"$1  \");\n                    // These leading spaces screw with <pre> content, so we need to fix that:\n                    bq = bq.replace(\n                            /(\\s*<pre>[^\\r]+?<\\/pre>)/gm,\n                        function (wholeMatch, m1) {\n                            var pre = m1;\n                            // attacklab: hack around Konqueror 3.5.4 bug:\n                            pre = pre.replace(/^  /mg, \"~0\");\n                            pre = pre.replace(/~0/g, \"\");\n                            return pre;\n                        });\n\n                    return hashBlock(\"<blockquote>\\n\" + bq + \"\\n</blockquote>\");\n                }\n            );\n            return text;\n        }\n\n        function _FormParagraphs(text, doNotUnhash) {\n            //\n            //  Params:\n            //    $text - string to process with html <p> tags\n            //\n\n            // Strip leading and trailing lines:\n            text = text.replace(/^\\n+/g, \"\");\n            text = text.replace(/\\n+$/g, \"\");\n\n            var grafs = text.split(/\\n{2,}/g);\n            var grafsOut = [];\n            \n            var markerRe = /~K(\\d+)K/;\n\n            //\n            // Wrap <p> tags.\n            //\n            var end = grafs.length;\n            for (var i = 0; i < end; i++) {\n                var str = grafs[i];\n\n                // if this is an HTML marker, copy it\n                if (markerRe.test(str)) {\n                    grafsOut.push(str);\n                }\n                else if (/\\S/.test(str)) {\n                    str = _RunSpanGamut(str);\n                    str = str.replace(/^([ \\t]*)/g, \"<p>\");\n                    str += \"</p>\"\n                    grafsOut.push(str);\n                }\n\n            }\n            //\n            // Unhashify HTML blocks\n            //\n            if (!doNotUnhash) {\n                end = grafsOut.length;\n                for (var i = 0; i < end; i++) {\n                    var foundAny = true;\n                    while (foundAny) { // we may need several runs, since the data may be nested\n                        foundAny = false;\n                        grafsOut[i] = grafsOut[i].replace(/~K(\\d+)K/g, function (wholeMatch, id) {\n                            foundAny = true;\n                            return g_html_blocks[id];\n                        });\n                    }\n                }\n            }\n            return grafsOut.join(\"\\n\\n\");\n        }\n\n        function _EncodeAmpsAndAngles(text) {\n            // Smart processing for ampersands and angle brackets that need to be encoded.\n\n            // Ampersand-encoding based entirely on Nat Irons's Amputator MT plugin:\n            //   http://bumppo.net/projects/amputator/\n            text = text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\\w+);)/g, \"&amp;\");\n\n            // Encode naked <'s\n            text = text.replace(/<(?![a-z\\/?!]|~D)/gi, \"&lt;\");\n\n            return text;\n        }\n\n        function _EncodeBackslashEscapes(text) {\n            //\n            //   Parameter:  String.\n            //   Returns:    The string, with after processing the following backslash\n            //               escape sequences.\n            //\n\n            // attacklab: The polite way to do this is with the new\n            // escapeCharacters() function:\n            //\n            //     text = escapeCharacters(text,\"\\\\\",true);\n            //     text = escapeCharacters(text,\"`*_{}[]()>#+-.!\",true);\n            //\n            // ...but we're sidestepping its use of the (slow) RegExp constructor\n            // as an optimization for Firefox.  This function gets called a LOT.\n\n            text = text.replace(/\\\\(\\\\)/g, escapeCharacters_callback);\n            text = text.replace(/\\\\([`*_{}\\[\\]()>#+-.!])/g, escapeCharacters_callback);\n            return text;\n        }\n\n        var charInsideUrl = \"[-A-Z0-9+&@#/%?=~_|[\\\\]()!:,.;]\",\n            charEndingUrl = \"[-A-Z0-9+&@#/%=~_|[\\\\])]\",\n            autoLinkRegex = new RegExp(\"(=\\\"|<)?\\\\b(https?|ftp)(://\" + charInsideUrl + \"*\" + charEndingUrl + \")(?=$|\\\\W)\", \"gi\"),\n            endCharRegex = new RegExp(charEndingUrl, \"i\");\n\n        function handleTrailingParens(wholeMatch, lookbehind, protocol, link) {\n            if (lookbehind)\n                return wholeMatch;\n            if (link.charAt(link.length - 1) !== \")\")\n                return \"<\" + protocol + link + \">\";\n            var parens = link.match(/[()]/g);\n            var level = 0;\n            for (var i = 0; i < parens.length; i++) {\n                if (parens[i] === \"(\") {\n                    if (level <= 0)\n                        level = 1;\n                    else\n                        level++;\n                }\n                else {\n                    level--;\n                }\n            }\n            var tail = \"\";\n            if (level < 0) {\n                var re = new RegExp(\"\\\\){1,\" + (-level) + \"}$\");\n                link = link.replace(re, function (trailingParens) {\n                    tail = trailingParens;\n                    return \"\";\n                });\n            }\n            if (tail) {\n                var lastChar = link.charAt(link.length - 1);\n                if (!endCharRegex.test(lastChar)) {\n                    tail = lastChar + tail;\n                    link = link.substr(0, link.length - 1);\n                }\n            }\n            return \"<\" + protocol + link + \">\" + tail;\n        }\n        \n        function _DoAutoLinks(text) {\n\n            // note that at this point, all other URL in the text are already hyperlinked as <a href=\"\"></a>\n            // *except* for the <http://www.foo.com> case\n\n            // automatically add < and > around unadorned raw hyperlinks\n            // must be preceded by a non-word character (and not by =\" or <) and followed by non-word/EOF character\n            // simulating the lookbehind in a consuming way is okay here, since a URL can neither and with a \" nor\n            // with a <, so there is no risk of overlapping matches.\n            text = text.replace(autoLinkRegex, handleTrailingParens);\n\n            //  autolink anything like <http://example.com>\n            \n            var replacer = function (wholematch, m1) { return \"<a href=\\\"\" + m1 + \"\\\">\" + pluginHooks.plainLinkText(m1) + \"</a>\"; }\n            text = text.replace(/<((https?|ftp):[^'\">\\s]+)>/gi, replacer);\n\n            // Email addresses: <address@domain.foo>\n            /*\n            text = text.replace(/\n                <\n                (?:mailto:)?\n                (\n                    [-.\\w]+\n                    \\@\n                    [-a-z0-9]+(\\.[-a-z0-9]+)*\\.[a-z]+\n                )\n                >\n            /gi, _DoAutoLinks_callback());\n            */\n\n            /* disabling email autolinking, since we don't do that on the server, either\n            text = text.replace(/<(?:mailto:)?([-.\\w]+\\@[-a-z0-9]+(\\.[-a-z0-9]+)*\\.[a-z]+)>/gi,\n                function(wholeMatch,m1) {\n                    return _EncodeEmailAddress( _UnescapeSpecialChars(m1) );\n                }\n            );\n            */\n            return text;\n        }\n\n        function _UnescapeSpecialChars(text) {\n            //\n            // Swap back in all the special characters we've hidden.\n            //\n            text = text.replace(/~E(\\d+)E/g,\n                function (wholeMatch, m1) {\n                    var charCodeToReplace = parseInt(m1);\n                    return String.fromCharCode(charCodeToReplace);\n                }\n            );\n            return text;\n        }\n\n        function _Outdent(text) {\n            //\n            // Remove one level of line-leading tabs or spaces\n            //\n\n            // attacklab: hack around Konqueror 3.5.4 bug:\n            // \"----------bug\".replace(/^-/g,\"\") == \"bug\"\n\n            text = text.replace(/^(\\t|[ ]{1,4})/gm, \"~0\"); // attacklab: g_tab_width\n\n            // attacklab: clean up hack\n            text = text.replace(/~0/g, \"\")\n\n            return text;\n        }\n\n        function _Detab(text) {\n            if (!/\\t/.test(text))\n                return text;\n\n            var spaces = [\"    \", \"   \", \"  \", \" \"],\n            skew = 0,\n            v;\n\n            return text.replace(/[\\n\\t]/g, function (match, offset) {\n                if (match === \"\\n\") {\n                    skew = offset + 1;\n                    return match;\n                }\n                v = (offset - skew) % 4;\n                skew = offset + 1;\n                return spaces[v];\n            });\n        }\n\n        //\n        //  attacklab: Utility functions\n        //\n\n        var _problemUrlChars = /(?:[\"'*()[\\]:]|~D)/g;\n\n        // hex-encodes some unusual \"problem\" chars in URLs to avoid URL detection problems \n        function encodeProblemUrlChars(url) {\n            if (!url)\n                return \"\";\n\n            var len = url.length;\n\n            return url.replace(_problemUrlChars, function (match, offset) {\n                if (match == \"~D\") // escape for dollar\n                    return \"%24\";\n                if (match == \":\") {\n                    //if (offset == len - 1 || /[0-9\\/]/.test(url.charAt(offset + 1)))\n                        return \":\"\n                }\n                return \"%\" + match.charCodeAt(0).toString(16);\n            });\n        }\n\n\n        function escapeCharacters(text, charsToEscape, afterBackslash) {\n            // First we have to escape the escape characters so that\n            // we can build a character class out of them\n            var regexString = \"([\" + charsToEscape.replace(/([\\[\\]\\\\])/g, \"\\\\$1\") + \"])\";\n\n            if (afterBackslash) {\n                regexString = \"\\\\\\\\\" + regexString;\n            }\n\n            var regex = new RegExp(regexString, \"g\");\n            text = text.replace(regex, escapeCharacters_callback);\n\n            return text;\n        }\n\n\n        function escapeCharacters_callback(wholeMatch, m1) {\n            var charCodeToEscape = m1.charCodeAt(0);\n            return \"~E\" + charCodeToEscape + \"E\";\n        }\n\n    }; // end of the Markdown.Converter constructor\n\n})();\n\nexport default Markdown\n","/* eslint-disable */\n\nimport Markdown from './Markdown.Converter'\nimport CodeMirror from 'codemirror'\n\n// needs Markdown.Converter.js at the moment\n\n(function () {\n\n    \n    var util = {},\n        position = {},\n        ui = {},\n        doc = window.document,\n        re = window.RegExp,\n        nav = window.navigator,\n        SETTINGS = { lineLength: 72 },\n\n    // Used to work around some browser bugs where we can't use feature testing.\n        uaSniffed = {\n            isIE: /msie/.test(nav.userAgent.toLowerCase()),\n            isIE_5or6: /msie 6/.test(nav.userAgent.toLowerCase()) || /msie 5/.test(nav.userAgent.toLowerCase()),\n            isOpera: /opera/.test(nav.userAgent.toLowerCase()),\n            isMac: (/AppleWebKit/.test(nav.userAgent) && /Mobile\\/\\w+/.test(nav.userAgent)) || /Mac/.test(nav.platform)\n        };\n\n    var defaultsStrings = {\n        bold: \"Strong <strong>\",\n        boldexample: \"strong text\",\n        \n        italic: \"Emphasis <em>\",\n        italicexample: \"emphasized text\",\n        \n        link: \"Hyperlink <a>\",\n        linkdescription: \"enter link description here\",\n        linkdialog: \"<p><b>Insert Hyperlink</b></p><p>http://example.com/ \\\"optional title\\\"</p>\",\n        \n        quote: \"Blockquote <blockquote>\",\n        quoteexample: \"Blockquote\",\n        \n        code: \"Code Sample <pre><code>\",\n        codeexample: \"enter code here\",\n        \n        image: \"Image <img>\",\n        imagedescription: \"enter image description here\",\n        imagedialog: \"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \\\"optional title\\\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>\",\n        \n        olist: \"Numbered List <ol>\",\n        ulist: \"Bulleted List <ul>\",\n        litem: \"List item\",\n        \n        heading: \"Heading <h1>/<h2>\",\n        headingexample: \"Heading\",\n        \n        hr: \"Horizontal Rule <hr>\",\n        \n        undo: \"Undo -\",\n        redo: \"Redo -\",\n        \n        help: \"Markdown Editing Help\"\n    };\n    \n    var keyStrokes = {\n        bold: {\n            win: 'Ctrl-B',\n            mac: 'Command-B|Ctrl-B',\n        },\n        italic: {\n            win: 'Ctrl-I',\n            mac: 'Command-I|Ctrl-I',\n        },\n        link: {\n            win: 'Ctrl-L',\n            mac: 'Command-L|Ctrl-L',\n        },\n        quote: {\n            win: 'Ctrl-Q',\n            mac: 'Command-Q|Ctrl-Q',\n        },\n        code: {\n            win: 'Ctrl-K',\n            mac: 'Command-K|Ctrl-K',\n        },\n        image: {\n            win: 'Ctrl-G',\n            mac: 'Command-G|Ctrl-G',\n        },\n        olist: {\n            win: 'Ctrl-O',\n            mac: 'Command-O|Ctrl-O',\n        },\n        ulist: {\n            win: 'Ctrl-U',\n            mac: 'Command-U|Ctrl-U',\n        },\n        heading: {\n            win: 'Ctrl-H',\n            mac: 'Command-H|Ctrl-H',\n        },\n        hr: {\n            win: 'Ctrl-R',\n            mac: 'Command-R|Ctrl-R',\n        },\n        undo: {\n            win: 'Ctrl-Z',\n            mac: 'Command-Z',\n        },\n        redo: {\n            win: 'Ctrl-Y|Ctrl-Shift-Z',\n            mac: 'Command-Y|Command-Shift-Z',\n        },\n    };\n\n\n    // -------------------------------------------------------------------\n    //  YOUR CHANGES GO HERE\n    //\n    // I've tried to localize the things you are likely to change to\n    // this area.\n    // -------------------------------------------------------------------\n\n    // The default text that appears in the dialog input box when entering\n    // links.\n    var imageDefaultText = \"http://\";\n    var linkDefaultText = \"http://\";\n\n    // -------------------------------------------------------------------\n    //  END OF YOUR CHANGES\n    // -------------------------------------------------------------------\n\n    // options, if given, can have the following properties:\n    //   options.helpButton = { handler: yourEventHandler }\n    //   options.strings = { italicexample: \"slanted text\" }\n    // `yourEventHandler` is the click handler for the help button.\n    // If `options.helpButton` isn't given, not help button is created.\n    // `options.strings` can have any or all of the same properties as\n    // `defaultStrings` above, so you can just override some string displayed\n    // to the user on a case-by-case basis, or translate all strings to\n    // a different language.\n    //\n    // For backwards compatibility reasons, the `options` argument can also\n    // be just the `helpButton` object, and `strings.help` can also be set via\n    // `helpButton.title`. This should be considered legacy.\n    //\n    // The constructed editor object has the methods:\n    // - getConverter() returns the markdown converter object that was passed to the constructor\n    // - run() actually starts the editor; should be called after all necessary plugins are registered. Calling this more than once is a no-op.\n    // - refreshPreview() forces the preview to be updated. This method is only available after run() was called.\n    Markdown.Editor = function (markdownConverter, idPostfix, options) {\n        \n        options = options || {};\n\n        if (typeof options.handler === \"function\") { //backwards compatible behavior\n            options = { helpButton: options };\n        }\n        options.strings = options.strings || {};\n        if (options.helpButton) {\n            options.strings.help = options.strings.help || options.helpButton.title;\n        }\n        // Override default keystrokes\n        if(options.keyStrokes) {\n            for(var key in options.keyStrokes) {\n                keyStrokes[key] = options.keyStrokes[key];\n            }\n        }\n        var getString = function (identifier) { return options.strings[identifier] || defaultsStrings[identifier]; }\n\n        idPostfix = idPostfix || \"\";\n\n        var hooks = this.hooks = new Markdown.HookCollection();\n        hooks.addNoop(\"onPreviewRefresh\");       // called with no arguments after the preview has been refreshed\n        hooks.addNoop(\"postBlockquoteCreation\"); // called with the user's selection *after* the blockquote was created; should return the actual to-be-inserted text\n        hooks.addFalse(\"insertImageDialog\");     /* called with one parameter: a callback to be called with the URL of the image. If the application creates\n                                                  * its own image insertion dialog, this hook should return true, and the callback should be called with the chosen\n                                                  * image url (or null if the user cancelled). If this hook returns false, the default dialog will be used.\n                                                  */\n        hooks.addFalse(\"insertLinkDialog\");\n\n        this.getConverter = function () { return markdownConverter; }\n\n        var that = this,\n            panels;\n\n        var undoManager;\n        this.run = function (cm, previewWrapper) {\n            if (panels)\n                return; // already initialized\n\n            panels = new PanelCollection(idPostfix, cm);\n            var commandManager = new CommandManager(hooks, getString);\n            var previewManager = new PreviewManager(markdownConverter, panels, function () { hooks.onPreviewRefresh(); }, previewWrapper);\n            var uiManager;\n\n            /*benweet\n            if (!/\\?noundo/.test(doc.location.href)) {\n                undoManager = new UndoManager(function () {\n                    previewManager.refresh();\n                    if (uiManager) // not available on the first call\n                        uiManager.setUndoRedoButtonStates();\n                }, panels);\n                this.textOperation = function (f) {\n                    undoManager.setCommandMode();\n                    f();\n                    that.refreshPreview();\n                }\n            }\n            */\n\n            var getKey = function (identifier) {\n                return keyStrokes[identifier][uaSniffed.isMac ? \"mac\" : \"win\"].split('|').join(' ');\n            };\n            uiManager = new UIManager(idPostfix, panels, undoManager, previewManager, commandManager, options.helpButton, getString, getKey);\n            uiManager.setUndoRedoButtonStates();\n\n            var forceRefresh = that.refreshPreview = function () { previewManager.refresh(true); };\n\n            forceRefresh();\n            that.uiManager = uiManager;\n        };\n\n    }\n\n    // before: contains all the text in the input box BEFORE the selection.\n    // after: contains all the text in the input box AFTER the selection.\n    function Chunks() { }\n\n    // startRegex: a regular expression to find the start tag\n    // endRegex: a regular expresssion to find the end tag\n    Chunks.prototype.findTags = function (startRegex, endRegex) {\n\n        var chunkObj = this;\n        var regex;\n\n        if (startRegex) {\n\n            regex = util.extendRegExp(startRegex, \"\", \"$\");\n\n            this.before = this.before.replace(regex,\n                function (match) {\n                    chunkObj.startTag = chunkObj.startTag + match;\n                    return \"\";\n                });\n\n            regex = util.extendRegExp(startRegex, \"^\", \"\");\n\n            this.selection = this.selection.replace(regex,\n                function (match) {\n                    chunkObj.startTag = chunkObj.startTag + match;\n                    return \"\";\n                });\n        }\n\n        if (endRegex) {\n\n            regex = util.extendRegExp(endRegex, \"\", \"$\");\n\n            this.selection = this.selection.replace(regex,\n                function (match) {\n                    chunkObj.endTag = match + chunkObj.endTag;\n                    return \"\";\n                });\n\n            regex = util.extendRegExp(endRegex, \"^\", \"\");\n\n            this.after = this.after.replace(regex,\n                function (match) {\n                    chunkObj.endTag = match + chunkObj.endTag;\n                    return \"\";\n                });\n        }\n    };\n\n    // If remove is false, the whitespace is transferred\n    // to the before/after regions.\n    //\n    // If remove is true, the whitespace disappears.\n    Chunks.prototype.trimWhitespace = function (remove) {\n        var beforeReplacer, afterReplacer, that = this;\n        if (remove) {\n            beforeReplacer = afterReplacer = \"\";\n        } else {\n            beforeReplacer = function (s) { that.before += s; return \"\"; }\n            afterReplacer = function (s) { that.after = s + that.after; return \"\"; }\n        }\n\n        this.selection = this.selection.replace(/^(\\s*)/, beforeReplacer).replace(/(\\s*)$/, afterReplacer);\n    };\n\n\n    Chunks.prototype.skipLines = function (nLinesBefore, nLinesAfter, findExtraNewlines) {\n\n        if (nLinesBefore === undefined) {\n            nLinesBefore = 1;\n        }\n\n        if (nLinesAfter === undefined) {\n            nLinesAfter = 1;\n        }\n\n        nLinesBefore++;\n        nLinesAfter++;\n\n        var regexText;\n        var replacementText;\n\n        // chrome bug ... documented at: http://meta.stackoverflow.com/questions/63307/blockquote-glitch-in-editor-in-chrome-6-and-7/65985#65985\n        if (navigator.userAgent.match(/Chrome/)) {\n            \"X\".match(/()./);\n        }\n\n        this.selection = this.selection.replace(/(^\\n*)/, \"\");\n\n        this.startTag = this.startTag + re.$1;\n\n        this.selection = this.selection.replace(/(\\n*$)/, \"\");\n        this.endTag = this.endTag + re.$1;\n        this.startTag = this.startTag.replace(/(^\\n*)/, \"\");\n        this.before = this.before + re.$1;\n        this.endTag = this.endTag.replace(/(\\n*$)/, \"\");\n        this.after = this.after + re.$1;\n\n        if (this.before) {\n\n            regexText = replacementText = \"\";\n\n            while (nLinesBefore--) {\n                regexText += \"\\\\n?\";\n                replacementText += \"\\n\";\n            }\n\n            if (findExtraNewlines) {\n                regexText = \"\\\\n*\";\n            }\n            this.before = this.before.replace(new re(regexText + \"$\", \"\"), replacementText);\n        }\n\n        if (this.after) {\n\n            regexText = replacementText = \"\";\n\n            while (nLinesAfter--) {\n                regexText += \"\\\\n?\";\n                replacementText += \"\\n\";\n            }\n            if (findExtraNewlines) {\n                regexText = \"\\\\n*\";\n            }\n\n            this.after = this.after.replace(new re(regexText, \"\"), replacementText);\n        }\n    };\n\n    // end of Chunks\n\n    // A collection of the important regions on the page.\n    // Cached so we don't have to keep traversing the DOM.\n    // Also holds ieCachedRange and ieCachedScrollTop, where necessary; working around\n    // this issue:\n    // Internet explorer has problems with CSS sprite buttons that use HTML\n    // lists.  When you click on the background image \"button\", IE will\n    // select the non-existent link text and discard the selection in the\n    // textarea.  The solution to this is to cache the textarea selection\n    // on the button's mousedown event and set a flag.  In the part of the\n    // code where we need to grab the selection, we check for the flag\n    // and, if it's set, use the cached area instead of querying the\n    // textarea.\n    //\n    // This ONLY affects Internet Explorer (tested on versions 6, 7\n    // and 8) and ONLY on button clicks.  Keyboard shortcuts work\n    // normally since the focus never leaves the textarea.\n    function PanelCollection(postfix, cm) {\n        this.buttonBar = doc.getElementById(\"wmd-button-bar\" + postfix);\n        this.preview = doc.getElementById(\"wmd-preview\" + postfix);\n        this.input = cm;\n    };\n\n    // Returns true if the DOM element is visible, false if it's hidden.\n    // Checks if display is anything other than none.\n    util.isVisible = function (elem) {\n\n        if (window.getComputedStyle) {\n            // Most browsers\n            return window.getComputedStyle(elem, null).getPropertyValue(\"display\") !== \"none\";\n        }\n        else if (elem.currentStyle) {\n            // IE\n            return elem.currentStyle[\"display\"] !== \"none\";\n        }\n    };\n\n\n    // Adds a listener callback to a DOM element which is fired on a specified\n    // event.\n    util.addEvent = function (elem, event, listener) {\n        if (elem.attachEvent) {\n            // IE only.  The \"on\" is mandatory.\n            elem.attachEvent(\"on\" + event, listener);\n        }\n        else {\n            // Other browsers.\n            elem.addEventListener(event, listener, false);\n        }\n    };\n\n\n    // Removes a listener callback from a DOM element which is fired on a specified\n    // event.\n    util.removeEvent = function (elem, event, listener) {\n        if (elem.detachEvent) {\n            // IE only.  The \"on\" is mandatory.\n            elem.detachEvent(\"on\" + event, listener);\n        }\n        else {\n            // Other browsers.\n            elem.removeEventListener(event, listener, false);\n        }\n    };\n\n    // Converts \\r\\n and \\r to \\n.\n    util.fixEolChars = function (text) {\n        text = text.replace(/\\r\\n/g, \"\\n\");\n        text = text.replace(/\\r/g, \"\\n\");\n        return text;\n    };\n\n    // Extends a regular expression.  Returns a new RegExp\n    // using pre + regex + post as the expression.\n    // Used in a few functions where we have a base\n    // expression and we want to pre- or append some\n    // conditions to it (e.g. adding \"$\" to the end).\n    // The flags are unchanged.\n    //\n    // regex is a RegExp, pre and post are strings.\n    util.extendRegExp = function (regex, pre, post) {\n\n        if (pre === null || pre === undefined) {\n            pre = \"\";\n        }\n        if (post === null || post === undefined) {\n            post = \"\";\n        }\n\n        var pattern = regex.toString();\n        var flags;\n\n        // Replace the flags with empty space and store them.\n        pattern = pattern.replace(/\\/([gim]*)$/, function (wholeMatch, flagsPart) {\n            flags = flagsPart;\n            return \"\";\n        });\n\n        // Remove the slash delimiters on the regular expression.\n        pattern = pattern.replace(/(^\\/|\\/$)/g, \"\");\n        pattern = pre + pattern + post;\n\n        return new re(pattern, flags);\n    }\n\n    // UNFINISHED\n    // The assignment in the while loop makes jslint cranky.\n    // I'll change it to a better loop later.\n    position.getTop = function (elem, isInner) {\n        var result = elem.offsetTop;\n        if (!isInner) {\n            while (elem = elem.offsetParent) {\n                result += elem.offsetTop;\n            }\n        }\n        return result;\n    };\n\n    position.getHeight = function (elem) {\n        return elem.offsetHeight || elem.scrollHeight;\n    };\n\n    position.getWidth = function (elem) {\n        return elem.offsetWidth || elem.scrollWidth;\n    };\n\n    position.getPageSize = function () {\n\n        var scrollWidth, scrollHeight;\n        var innerWidth, innerHeight;\n\n        // It's not very clear which blocks work with which browsers.\n        if (this.innerHeight && this.scrollMaxY) {\n            scrollWidth = doc.body.scrollWidth;\n            scrollHeight = this.innerHeight + this.scrollMaxY;\n        }\n        else if (doc.body.scrollHeight > doc.body.offsetHeight) {\n            scrollWidth = doc.body.scrollWidth;\n            scrollHeight = doc.body.scrollHeight;\n        }\n        else {\n            scrollWidth = doc.body.offsetWidth;\n            scrollHeight = doc.body.offsetHeight;\n        }\n\n        if (this.innerHeight) {\n            // Non-IE browser\n            innerWidth = this.innerWidth;\n            innerHeight = this.innerHeight;\n        }\n        else if (doc.documentElement && doc.documentElement.clientHeight) {\n            // Some versions of IE (IE 6 w/ a DOCTYPE declaration)\n            innerWidth = doc.documentElement.clientWidth;\n            innerHeight = doc.documentElement.clientHeight;\n        }\n        else if (doc.body) {\n            // Other versions of IE\n            innerWidth = doc.body.clientWidth;\n            innerHeight = doc.body.clientHeight;\n        }\n\n        var maxWidth = Math.max(scrollWidth, innerWidth);\n        var maxHeight = Math.max(scrollHeight, innerHeight);\n        return [maxWidth, maxHeight, innerWidth, innerHeight];\n    };\n\n    /*benweet\n    // Handles pushing and popping TextareaStates for undo/redo commands.\n    // I should rename the stack variables to list.\n    function UndoManager(callback, panels) {\n\n        var undoObj = this;\n        var undoStack = []; // A stack of undo states\n        var stackPtr = 0; // The index of the current state\n        var mode = \"none\";\n        var lastState; // The last state\n        var timer; // The setTimeout handle for cancelling the timer\n        var inputStateObj;\n\n        // Set the mode for later logic steps.\n        var setMode = function (newMode, noSave) {\n            if (mode != newMode) {\n                mode = newMode;\n                if (!noSave) {\n                    saveState();\n                }\n            }\n\n            if (!uaSniffed.isIE || mode != \"moving\") {\n                timer = setTimeout(refreshState, 1);\n            }\n            else {\n                inputStateObj = null;\n            }\n        };\n\n        var refreshState = function (isInitialState) {\n            inputStateObj = new TextareaState(panels, isInitialState);\n            timer = undefined;\n        };\n\n        this.setCommandMode = function () {\n            mode = \"command\";\n            saveState();\n            timer = setTimeout(refreshState, 0);\n        };\n\n        this.canUndo = function () {\n            return stackPtr > 1;\n        };\n\n        this.canRedo = function () {\n            if (undoStack[stackPtr + 1]) {\n                return true;\n            }\n            return false;\n        };\n\n        // Removes the last state and restores it.\n        this.undo = function () {\n\n            if (undoObj.canUndo()) {\n                if (lastState) {\n                    // What about setting state -1 to null or checking for undefined?\n                    lastState.restore();\n                    lastState = null;\n                }\n                else {\n                    undoStack[stackPtr] = new TextareaState(panels);\n                    undoStack[--stackPtr].restore();\n\n                    if (callback) {\n                        callback();\n                    }\n                }\n            }\n\n            mode = \"none\";\n            panels.input.focus();\n            refreshState();\n        };\n\n        // Redo an action.\n        this.redo = function () {\n\n            if (undoObj.canRedo()) {\n\n                undoStack[++stackPtr].restore();\n\n                if (callback) {\n                    callback();\n                }\n            }\n\n            mode = \"none\";\n            panels.input.focus();\n            refreshState();\n        };\n\n        // Push the input area state to the stack.\n        var saveState = function () {\n            var currState = inputStateObj || new TextareaState(panels);\n\n            if (!currState) {\n                return false;\n            }\n            if (mode == \"moving\") {\n                if (!lastState) {\n                    lastState = currState;\n                }\n                return;\n            }\n            if (lastState) {\n                if (undoStack[stackPtr - 1].text != lastState.text) {\n                    undoStack[stackPtr++] = lastState;\n                }\n                lastState = null;\n            }\n            undoStack[stackPtr++] = currState;\n            undoStack[stackPtr + 1] = null;\n            if (callback) {\n                callback();\n            }\n        };\n\n        var handleCtrlYZ = function (event) {\n\n            var handled = false;\n\n            if ((event.ctrlKey || event.metaKey) && !event.altKey) {\n\n                // IE and Opera do not support charCode.\n                var keyCode = event.charCode || event.keyCode;\n                var keyCodeChar = String.fromCharCode(keyCode);\n\n                switch (keyCodeChar.toLowerCase()) {\n\n                    case \"y\":\n                        undoObj.redo();\n                        handled = true;\n                        break;\n\n                    case \"z\":\n                        if (!event.shiftKey) {\n                            undoObj.undo();\n                        }\n                        else {\n                            undoObj.redo();\n                        }\n                        handled = true;\n                        break;\n                }\n            }\n\n            if (handled) {\n                if (event.preventDefault) {\n                    event.preventDefault();\n                }\n                if (window.event) {\n                    window.event.returnValue = false;\n                }\n                return;\n            }\n        };\n\n        // Set the mode depending on what is going on in the input area.\n        var handleModeChange = function (event) {\n\n            if (!event.ctrlKey && !event.metaKey) {\n\n                var keyCode = event.keyCode;\n\n                if ((keyCode >= 33 && keyCode <= 40) || (keyCode >= 63232 && keyCode <= 63235)) {\n                    // 33 - 40: page up/dn and arrow keys\n                    // 63232 - 63235: page up/dn and arrow keys on safari\n                    setMode(\"moving\");\n                }\n                else if (keyCode == 8 || keyCode == 46 || keyCode == 127) {\n                    // 8: backspace\n                    // 46: delete\n                    // 127: delete\n                    setMode(\"deleting\");\n                }\n                else if (keyCode == 13) {\n                    // 13: Enter\n                    setMode(\"newlines\");\n                }\n                else if (keyCode == 27) {\n                    // 27: escape\n                    setMode(\"escape\");\n                }\n                else if ((keyCode < 16 || keyCode > 20) && keyCode != 91) {\n                    // 16-20 are shift, etc.\n                    // 91: left window key\n                    // I think this might be a little messed up since there are\n                    // a lot of nonprinting keys above 20.\n                    setMode(\"typing\");\n                }\n            }\n        };\n\n        var setEventHandlers = function () {\n            util.addEvent(panels.input, \"keypress\", function (event) {\n                // keyCode 89: y\n                // keyCode 90: z\n                if ((event.ctrlKey || event.metaKey) && !event.altKey && (event.keyCode == 89 || event.keyCode == 90)) {\n                    event.preventDefault();\n                }\n            });\n\n            var handlePaste = function () {\n                if (uaSniffed.isIE || (inputStateObj && inputStateObj.text != panels.input.value)) {\n                    if (timer == undefined) {\n                        mode = \"paste\";\n                        saveState();\n                        refreshState();\n                    }\n                }\n            };\n\n            //util.addEvent(panels.input, \"keydown\", handleCtrlYZ);\n            util.addEvent(panels.input, \"keydown\", handleModeChange);\n            util.addEvent(panels.input, \"mousedown\", function () {\n                setMode(\"moving\");\n            });\n\n            panels.input.onpaste = handlePaste;\n            panels.input.ondrop = handlePaste;\n        };\n\n        var init = function () {\n            setEventHandlers();\n            refreshState(true);\n            //Not necessary\n            //saveState();\n        };\n        \n        this.reinit = function(content, start, end, scrollTop) {\n            undoStack = [];\n            stackPtr = 0;\n            mode = \"none\";\n            lastState = undefined;\n            timer = undefined;\n            refreshState();\n            inputStateObj.text = content;\n            inputStateObj.start = start;\n            inputStateObj.end = end;\n            inputStateObj.scrollTop = scrollTop;\n            inputStateObj.setInputAreaSelection();\n            saveState();\n        };\n        this.setMode = setMode;\n\n        init();\n    }\n\n    // end of UndoManager\n    */\n\n    // The input textarea state/contents.\n    // This is used to implement undo/redo by the undo manager.\n    function TextareaState(panels, isInitialState) {\n\n        // Aliases\n        var stateObj = this;\n        var inputArea = panels.input;\n        this.init = function () {\n            /*benweet\n            if (!util.isVisible(inputArea)) {\n                return;\n            }\n            if (!isInitialState && doc.activeElement && doc.activeElement !== inputArea) { // this happens when tabbing out of the input box\n                return;\n            }\n            */\n\n            (function() {\n                stateObj.before = inputArea.doc.getRange(CodeMirror.Pos(0,0),inputArea.doc.getCursor(\"from\"));\n                stateObj.selection = inputArea.doc.getSelection();\n                stateObj.after = inputArea.doc.getRange(inputArea.doc.getCursor(\"to\"),inputArea.doc.posFromIndex(Number.MAX_VALUE));\n            })();\n            this.text = [this.before, this.selection, this.after].join('');\n            this.length = this.text.length;\n            this.setInputAreaSelectionStartEnd();\n            this.scrollTop = inputArea.doc.scrollTop || 0;\n            /*benweet\n            if (!this.text && inputArea.selectionStart || inputArea.selectionStart === 0) {\n                this.text = inputArea.value;\n            }\n            */\n        }\n\n        // Sets the selected text in the input box after we've performed an\n        // operation.\n        this.setInputAreaSelection = function () {\n\n            inputArea.doc.setSelection(inputArea.doc.posFromIndex(stateObj.start),inputArea.doc.posFromIndex(stateObj.end),{scroll:true});\n            inputArea.focus();\n            \n            /*benweet\n            if (!util.isVisible(inputArea)) {\n                return;\n            }\n\n            if (inputArea.selectionStart !== undefined && !uaSniffed.isOpera) {\n\n                inputArea.focus();\n                inputArea.selectionStart = stateObj.start;\n                inputArea.selectionEnd = stateObj.end;\n                inputArea.scrollTop = stateObj.scrollTop;\n            }\n            else if (doc.selection) {\n\n                if (doc.activeElement && doc.activeElement !== inputArea) {\n                    return;\n                }\n\n                inputArea.focus();\n                var range = inputArea.createTextRange();\n                range.moveStart(\"character\", -inputArea.value.length);\n                range.moveEnd(\"character\", -inputArea.value.length);\n                range.moveEnd(\"character\", stateObj.end);\n                range.moveStart(\"character\", stateObj.start);\n                range.select();\n            }\n            */\n        };\n\n        this.setInputAreaSelectionStartEnd = function () {\n            \n            stateObj.start = stateObj.before.length;\n            stateObj.end = stateObj.after.length;\n            \n            /*benweet\n            if (!panels.ieCachedRange && (inputArea.selectionStart || inputArea.selectionStart === 0)) {\n\n                stateObj.start = inputArea.selectionStart;\n                stateObj.end = inputArea.selectionEnd;\n            }\n            else if (doc.selection) {\n\n                stateObj.text = util.fixEolChars(inputArea.value);\n\n                // IE loses the selection in the textarea when buttons are\n                // clicked.  On IE we cache the selection. Here, if something is cached,\n                // we take it.\n                var range = panels.ieCachedRange || doc.selection.createRange();\n\n                var fixedRange = util.fixEolChars(range.text);\n                var marker = \"\\x07\";\n                var markedRange = marker + fixedRange + marker;\n                range.text = markedRange;\n                var inputText = util.fixEolChars(inputArea.value);\n\n                range.moveStart(\"character\", -markedRange.length);\n                range.text = fixedRange;\n\n                stateObj.start = inputText.indexOf(marker);\n                stateObj.end = inputText.lastIndexOf(marker) - marker.length;\n\n                var len = stateObj.text.length - util.fixEolChars(inputArea.value).length;\n\n                if (len) {\n                    range.moveStart(\"character\", -fixedRange.length);\n                    while (len--) {\n                        fixedRange += \"\\n\";\n                        stateObj.end += 1;\n                    }\n                    range.text = fixedRange;\n                }\n\n                if (panels.ieCachedRange)\n                    stateObj.scrollTop = panels.ieCachedScrollTop; // this is set alongside with ieCachedRange\n\n                panels.ieCachedRange = null;\n\n                this.setInputAreaSelection();\n            }\n            */\n        };\n\n        // Restore this state into the input area.\n        this.restore = function () {\n            // Here we could do editor.setValue but we want to update the less we can for undo management\n            \n            // Find the first modified char\n            var startIndex = 0;\n            var startIndexMax = stateObj.before.length; \n            while(startIndex < startIndexMax) {\n                if(stateObj.before.charCodeAt(startIndex) !== stateObj.text.charCodeAt(startIndex))\n                    break;\n                startIndex++;\n            }\n            // Find the last modified char\n            var endIndex = 0;\n            var endIndexMax = stateObj.after.length;\n            var beforeMaxOffset = stateObj.after.length - 1;\n            var afterMaxOffset = stateObj.text.length - 1;\n            while(endIndex < endIndexMax) {\n                if(stateObj.after.charCodeAt(beforeMaxOffset - endIndex) !== stateObj.text.charCodeAt(afterMaxOffset - endIndex))\n                    break;\n                endIndex++;\n            }\n            \n            inputArea.doc.replaceRange(stateObj.text.substring(startIndex, afterMaxOffset - endIndex + 1),\n                inputArea.doc.posFromIndex(startIndex),\n                inputArea.doc.posFromIndex(stateObj.length - endIndex)\n            );\n            this.setInputAreaSelection();\n\n            /*benweet\n            if (stateObj.text != undefined && stateObj.text != inputArea.value) {\n                inputArea.value = stateObj.text;\n            }\n            inputArea.scrollTop = stateObj.scrollTop;\n            */\n        };\n\n        // Gets a collection of HTML chunks from the inptut textarea.\n        this.getChunks = function () {\n\n            var chunk = new Chunks();\n            chunk.before = stateObj.before;\n            chunk.startTag = \"\";\n            chunk.selection = stateObj.selection;\n            chunk.endTag = \"\";\n            chunk.after = stateObj.after;\n            chunk.scrollTop = stateObj.scrollTop;\n\n            return chunk;\n        };\n\n        // Sets the TextareaState properties given a chunk of markdown.\n        this.setChunks = function (chunk) {\n\n            chunk.before = chunk.before + chunk.startTag;\n            chunk.after = chunk.endTag + chunk.after;\n\n            this.start = chunk.before.length;\n            this.end = chunk.before.length + chunk.selection.length;\n            this.text = chunk.before + chunk.selection + chunk.after;\n            this.scrollTop = chunk.scrollTop;\n        };\n        this.init();\n    };\n\n    function PreviewManager(converter, panels, previewRefreshCallback, previewWrapper) {\n\n        var managerObj = this;\n        var timeout;\n        var elapsedTime;\n        var oldInputText;\n        var maxDelay = 3000;\n        var startType = \"delayed\"; // The other legal value is \"manual\"\n\n        // Adds event listeners to elements\n        /*benweet\n        var setupEvents = function (inputElem, listener) {\n\n            util.addEvent(inputElem, \"input\", listener);\n            inputElem.onpaste = listener;\n            inputElem.ondrop = listener;\n\n            util.addEvent(inputElem, \"keypress\", listener);\n            util.addEvent(inputElem, \"keydown\", listener);\n        };\n        */\n\n        var getDocScrollTop = function () {\n\n            var result = 0;\n\n            if (window.innerHeight) {\n                result = window.pageYOffset;\n            }\n            else\n                if (doc.documentElement && doc.documentElement.scrollTop) {\n                    result = doc.documentElement.scrollTop;\n                }\n                else\n                    if (doc.body) {\n                        result = doc.body.scrollTop;\n                    }\n\n            return result;\n        };\n\n        var makePreviewHtml = function () {\n\n            // If there is no registered preview panel\n            // there is nothing to do.\n            if (!panels.preview)\n                return;\n\n\n            var text = panels.input.doc.getValue();\n            if (text && text == oldInputText) {\n                return; // Input text hasn't changed.\n            }\n            else {\n                oldInputText = text;\n            }\n\n            var prevTime = new Date().getTime();\n\n            text = converter.makeHtml(text);\n\n            // Calculate the processing time of the HTML creation.\n            // It's used as the delay time in the event listener.\n            var currTime = new Date().getTime();\n            elapsedTime = currTime - prevTime;\n\n            pushPreviewHtml(text);\n        };\n        if(previewWrapper !== undefined) {\n            makePreviewHtml = previewWrapper(makePreviewHtml);\n        }\n\n        // setTimeout is already used.  Used as an event listener.\n        var applyTimeout = function () {\n\n            if (timeout) {\n                clearTimeout(timeout);\n                timeout = undefined;\n            }\n\n            if (startType !== \"manual\") {\n\n                var delay = 0;\n\n                if (startType === \"delayed\") {\n                    delay = elapsedTime;\n                }\n\n                if (delay > maxDelay) {\n                    delay = maxDelay;\n                }\n                timeout = setTimeout(makePreviewHtml, delay);\n            }\n        };\n\n        var getScaleFactor = function (panel) {\n            if (panel.scrollHeight <= panel.clientHeight) {\n                return 1;\n            }\n            return panel.scrollTop / (panel.scrollHeight - panel.clientHeight);\n        };\n\n        var setPanelScrollTops = function () {\n            if (panels.preview) {\n                panels.preview.scrollTop = (panels.preview.scrollHeight - panels.preview.clientHeight) * getScaleFactor(panels.preview);\n            }\n        };\n\n        this.refresh = function (requiresRefresh) {\n\n            if (requiresRefresh) {\n                oldInputText = \"\";\n                makePreviewHtml();\n            }\n            else {\n                applyTimeout();\n            }\n        };\n\n        this.processingTime = function () {\n            return elapsedTime;\n        };\n\n        var isFirstTimeFilled = true;\n\n        // IE doesn't let you use innerHTML if the element is contained somewhere in a table\n        // (which is the case for inline editing) -- in that case, detach the element, set the\n        // value, and reattach. Yes, that *is* ridiculous.\n        var ieSafePreviewSet = function (text) {\n            var preview = panels.preview;\n            var parent = preview.parentNode;\n            var sibling = preview.nextSibling;\n            parent.removeChild(preview);\n            preview.innerHTML = text;\n            if (!sibling)\n                parent.appendChild(preview);\n            else\n                parent.insertBefore(preview, sibling);\n        }\n\n        var nonSuckyBrowserPreviewSet = function (text) {\n            panels.preview.innerHTML = text;\n        }\n\n        var previewSetter;\n\n        var previewSet = function (text) {\n            if (previewSetter)\n                return previewSetter(text);\n\n            try {\n                nonSuckyBrowserPreviewSet(text);\n                previewSetter = nonSuckyBrowserPreviewSet;\n            } catch (e) {\n                previewSetter = ieSafePreviewSet;\n                previewSetter(text);\n            }\n        };\n\n        var pushPreviewHtml = function (text) {\n\n            var emptyTop = position.getTop(panels.input.doc) - getDocScrollTop();\n\n            if (panels.preview) {\n                previewSet(text);\n                previewRefreshCallback();\n            }\n\n            setPanelScrollTops();\n\n            if (isFirstTimeFilled) {\n                isFirstTimeFilled = false;\n                return;\n            }\n\n            var fullTop = position.getTop(panels.input.doc) - getDocScrollTop();\n\n            if (uaSniffed.isIE) {\n                setTimeout(function () {\n                    window.scrollBy(0, fullTop - emptyTop);\n                }, 0);\n            }\n            else {\n                window.scrollBy(0, fullTop - emptyTop);\n            }\n        };\n\n        var init = function () {\n\n            /*benweet\n            setupEvents(panels.input, applyTimeout);\n            */\n            panels.input.on('change', applyTimeout);\n            //Not necessary\n            //makePreviewHtml();\n\n            if (panels.preview) {\n                panels.preview.scrollTop = 0;\n            }\n        };\n\n        init();\n    };\n\n    // Creates the background behind the hyperlink text entry box.\n    // And download dialog\n    // Most of this has been moved to CSS but the div creation and\n    // browser-specific hacks remain here.\n    ui.createBackground = function () {\n\n        var background = doc.createElement(\"div\"),\n            style = background.style;\n        \n        background.className = \"wmd-prompt-background\";\n        \n        style.position = \"absolute\";\n        style.top = \"0\";\n\n        style.zIndex = \"1000\";\n\n        if (uaSniffed.isIE) {\n            style.filter = \"alpha(opacity=50)\";\n        }\n        else {\n            style.opacity = \"0.5\";\n        }\n\n        var pageSize = position.getPageSize();\n        style.height = pageSize[1] + \"px\";\n\n        if (uaSniffed.isIE) {\n            style.left = doc.documentElement.scrollLeft;\n            style.width = doc.documentElement.clientWidth;\n        }\n        else {\n            style.left = \"0\";\n            style.width = \"100%\";\n        }\n\n        doc.body.appendChild(background);\n        return background;\n    };\n\n    // This simulates a modal dialog box and asks for the URL when you\n    // click the hyperlink or image buttons.\n    //\n    // text: The html for the input box.\n    // defaultInputText: The default value that appears in the input box.\n    // callback: The function which is executed when the prompt is dismissed, either via OK or Cancel.\n    //      It receives a single argument; either the entered text (if OK was chosen) or null (if Cancel\n    //      was chosen).\n    ui.prompt = function (text, defaultInputText, callback) {\n\n        // These variables need to be declared at this level since they are used\n        // in multiple functions.\n        var dialog;         // The dialog box.\n        var input;         // The text box where you enter the hyperlink.\n\n\n        if (defaultInputText === undefined) {\n            defaultInputText = \"\";\n        }\n\n        // Used as a keydown event handler. Esc dismisses the prompt.\n        // Key code 27 is ESC.\n        var checkEscape = function (key) {\n            var code = (key.charCode || key.keyCode);\n            if (code === 27) {\n                close(true);\n            }\n        };\n\n        // Dismisses the hyperlink input box.\n        // isCancel is true if we don't care about the input text.\n        // isCancel is false if we are going to keep the text.\n        var close = function (isCancel) {\n            util.removeEvent(doc.body, \"keydown\", checkEscape);\n            var text = input.value;\n\n            if (isCancel) {\n                text = null;\n            }\n            else {\n                // Fixes common pasting errors.\n                text = text.replace(/^http:\\/\\/(https?|ftp):\\/\\//, '$1://');\n                if (!/^(?:https?|ftp):\\/\\//.test(text))\n                    text = 'http://' + text;\n            }\n\n            dialog.parentNode.removeChild(dialog);\n\n            callback(text);\n            return false;\n        };\n\n\n\n        // Create the text input box form/window.\n        var createDialog = function () {\n\n            // The main dialog box.\n            dialog = doc.createElement(\"div\");\n            dialog.className = \"wmd-prompt-dialog\";\n            dialog.style.padding = \"10px;\";\n            dialog.style.position = \"fixed\";\n            dialog.style.width = \"400px\";\n            dialog.style.zIndex = \"1001\";\n\n            // The dialog text.\n            var question = doc.createElement(\"div\");\n            question.innerHTML = text;\n            question.style.padding = \"5px\";\n            dialog.appendChild(question);\n\n            // The web form container for the text box and buttons.\n            var form = doc.createElement(\"form\"),\n                style = form.style;\n            form.onsubmit = function () { return close(false); };\n            style.padding = \"0\";\n            style.margin = \"0\";\n            style.cssFloat = \"left\";\n            style.width = \"100%\";\n            style.textAlign = \"center\";\n            style.position = \"relative\";\n            dialog.appendChild(form);\n\n            // The input text box\n            input = doc.createElement(\"input\");\n            input.type = \"text\";\n            input.value = defaultInputText;\n            style = input.style;\n            style.display = \"block\";\n            style.width = \"80%\";\n            style.marginLeft = style.marginRight = \"auto\";\n            form.appendChild(input);\n\n            // The ok button\n            var okButton = doc.createElement(\"input\");\n            okButton.type = \"button\";\n            okButton.onclick = function () { return close(false); };\n            okButton.value = \"OK\";\n            style = okButton.style;\n            style.margin = \"10px\";\n            style.display = \"inline\";\n            style.width = \"7em\";\n\n\n            // The cancel button\n            var cancelButton = doc.createElement(\"input\");\n            cancelButton.type = \"button\";\n            cancelButton.onclick = function () { return close(true); };\n            cancelButton.value = \"Cancel\";\n            style = cancelButton.style;\n            style.margin = \"10px\";\n            style.display = \"inline\";\n            style.width = \"7em\";\n\n            form.appendChild(okButton);\n            form.appendChild(cancelButton);\n\n            util.addEvent(doc.body, \"keydown\", checkEscape);\n            dialog.style.top = \"50%\";\n            dialog.style.left = \"50%\";\n            dialog.style.display = \"block\";\n            if (uaSniffed.isIE_5or6) {\n                dialog.style.position = \"absolute\";\n                dialog.style.top = doc.documentElement.scrollTop + 200 + \"px\";\n                dialog.style.left = \"50%\";\n            }\n            doc.body.appendChild(dialog);\n\n            // This has to be done AFTER adding the dialog to the form if you\n            // want it to be centered.\n            dialog.style.marginTop = -(position.getHeight(dialog) / 2) + \"px\";\n            dialog.style.marginLeft = -(position.getWidth(dialog) / 2) + \"px\";\n\n        };\n\n        // Why is this in a zero-length timeout?\n        // Is it working around a browser bug?\n        setTimeout(function () {\n\n            createDialog();\n\n            /*var defTextLen = defaultInputText.length;\n            if (input.selectionStart !== undefined) {\n                input.selectionStart = 0;\n                input.selectionEnd = defTextLen;\n            }\n            else if (input.createTextRange) {\n                var range = input.createTextRange();\n                range.collapse(false);\n                range.moveStart(\"character\", -defTextLen);\n                range.moveEnd(\"character\", defTextLen);\n                range.select();\n            }*/\n\n            input.focus();\n        }, 0);\n    };\n\n    function UIManager(postfix, panels, undoManager, previewManager, commandManager, helpOptions, getString, getKey) {\n        var getStringAndKey = function (identifier) { return getString(identifier) + ' ' + getKey(identifier); };\n\n        var inputBox = panels.input,\n            buttons = {}; // buttons.undo, buttons.link, etc. The actual DOM elements.\n\n        this.setUndoRedoButtonStates = function() {\n            setTimeout(function() {\n                setupButton(buttons.undo, inputBox.doc.history.done.length > 0);\n                setupButton(buttons.redo, inputBox.doc.history.undone.length > 0);\n            }, 50);\n        };\n\n        var that = this;\n        makeSpritedButtonRow();\n\n        var keyEvent = \"keydown\";\n        if (uaSniffed.isOpera) {\n            keyEvent = \"keypress\";\n        }\n\n        function addKeyCmd(identifierList) {\n            if(identifierList.length === 0) {\n                return;\n            }\n            var eKeys = {};\n            for(var i=identifierList.length-1; i>=0; i--)\n            {\n                var identifier = identifierList[i];\n                eKeys[getKey(identifier)] = (function(identifier){\n                    return function(editor) { doClick(buttons[identifier]); };\n                })(identifier);\n            }\n            inputBox.addKeyMap(eKeys);\n        };\n        addKeyCmd(['bold', 'italic', 'link', 'quote', 'code', 'image', 'olist', 'ulist', 'heading', 'hr']);\n        \n        /*benweet\n        util.addEvent(inputBox, keyEvent, function (key) {\n\n            // Check to see if we have a button key and, if so execute the callback.\n            if ((key.ctrlKey || key.metaKey) && !key.altKey) {\n\n                var keyCode = key.charCode || key.keyCode;\n                var keyCodeStr = String.fromCharCode(keyCode).toLowerCase();\n\n                switch (keyCodeStr) {\n                    case \"b\":\n                        doClick(buttons.bold);\n                        break;\n                    case \"i\":\n                        doClick(buttons.italic);\n                        break;\n                    case \"l\":\n                        doClick(buttons.link);\n                        break;\n                    case \"q\":\n                        doClick(buttons.quote);\n                        break;\n                    case \"k\":\n                        doClick(buttons.code);\n                        break;\n                    case \"g\":\n                        doClick(buttons.image);\n                        break;\n                    case \"o\":\n                        doClick(buttons.olist);\n                        break;\n                    case \"u\":\n                        doClick(buttons.ulist);\n                        break;\n                    case \"h\":\n                        doClick(buttons.heading);\n                        break;\n                    case \"r\":\n                        doClick(buttons.hr);\n                        break;\n                    case \"y\":\n                        doClick(buttons.redo);\n                        break;\n                    case \"z\":\n                        if (key.shiftKey) {\n                            doClick(buttons.redo);\n                        }\n                        else {\n                            doClick(buttons.undo);\n                        }\n                        break;\n                    case \"v\":\n                        undoManager.setMode(\"typing\");\n                        return;\n                    case \"x\":\n                        undoManager.setMode(\"deleting\");\n                        return;\n                    default:\n                        return;\n                }\n\n\n                if (key.preventDefault) {\n                    key.preventDefault();\n                }\n\n                if (window.event) {\n                    window.event.returnValue = false;\n                }\n            }\n        });\n\n        // Auto-indent on shift-enter\n        util.addEvent(inputBox, \"keyup\", function (key) {\n            if (key.shiftKey && !key.ctrlKey && !key.metaKey) {\n                var keyCode = key.charCode || key.keyCode;\n                // Character 13 is Enter\n                if (keyCode === 13) {\n                    var fakeButton = {};\n                    fakeButton.textOp = bindCommand(\"doAutoindent\");\n                    doClick(fakeButton);\n                }\n            }\n        });\n\n        // special handler because IE clears the context of the textbox on ESC\n        if (uaSniffed.isIE) {\n            util.addEvent(inputBox, \"keydown\", function (key) {\n                var code = key.keyCode;\n                if (code === 27) {\n                    return false;\n                }\n            });\n        }\n        */\n\n\n        // Perform the button's action.\n        function doClick(button) {\n\n            inputBox.focus();\n            var linkOrImage = button.id == \"wmd-link-button\" || button.id == \"wmd-image-button\";\n\n            if (button.textOp) {\n\n                if (undoManager && !linkOrImage) {\n                    undoManager.setCommandMode();\n                }\n\n                var state = new TextareaState(panels);\n\n                if (!state) {\n                    return;\n                }\n\n                var chunks = state.getChunks();\n\n                // Some commands launch a \"modal\" prompt dialog.  Javascript\n                // can't really make a modal dialog box and the WMD code\n                // will continue to execute while the dialog is displayed.\n                // This prevents the dialog pattern I'm used to and means\n                // I can't do something like this:\n                //\n                // var link = CreateLinkDialog();\n                // makeMarkdownLink(link);\n                //\n                // Instead of this straightforward method of handling a\n                // dialog I have to pass any code which would execute\n                // after the dialog is dismissed (e.g. link creation)\n                // in a function parameter.\n                //\n                // Yes this is awkward and I think it sucks, but there's\n                // no real workaround.  Only the image and link code\n                // create dialogs and require the function pointers.\n                var fixupInputArea = function () {\n\n                    inputBox.focus();\n\n                    if (chunks) {\n                        state.setChunks(chunks);\n                    }\n\n                    state.restore();\n                    previewManager.refresh();\n                };\n\n                var noCleanup = button.textOp(chunks, fixupInputArea);\n\n                if (!noCleanup) {\n                    fixupInputArea();\n                    /*benweet\n                    if(!linkOrImage) {\n                        inputBox.dispatchEvent(new Event('input'));\n                    }\n                    */\n                }\n\n            }\n\n            if (button.execute) {\n                button.execute(undoManager);\n            }\n        };\n\n        function setupButton(button, isEnabled) {\n\n            var normalYShift = \"0px\";\n            var disabledYShift = \"-20px\";\n            var highlightYShift = \"-40px\";\n            var image = button.getElementsByTagName(\"span\")[0];\n            button.className = button.className.replace(/ disabled/g, \"\");\n            if (isEnabled) {\n                image.style.backgroundPosition = button.XShift + \" \" + normalYShift;\n                button.onmouseover = function () {\n                    image.style.backgroundPosition = this.XShift + \" \" + highlightYShift;\n                };\n\n                button.onmouseout = function () {\n                    image.style.backgroundPosition = this.XShift + \" \" + normalYShift;\n                };\n\n                // IE tries to select the background image \"button\" text (it's\n                // implemented in a list item) so we have to cache the selection\n                // on mousedown.\n                if (uaSniffed.isIE) {\n                    button.onmousedown = function () {\n                        if (doc.activeElement && doc.activeElement !== panels.input.doc) { // we're not even in the input box, so there's no selection\n                            return;\n                        }\n                        panels.ieCachedRange = document.selection.createRange();\n                        panels.ieCachedScrollTop = panels.input.doc.scrollTop||0;\n                    };\n                }\n\n                if (!button.isHelp) {\n                    button.onclick = function () {\n                        if (this.onmouseout) {\n                            this.onmouseout();\n                        }\n                        doClick(this);\n                        return false;\n                    }\n                }\n            }\n            else {\n                image.style.backgroundPosition = button.XShift + \" \" + disabledYShift;\n                button.onmouseover = button.onmouseout = button.onclick = function () { };\n                button.className += \" disabled\";\n            }\n        }\n\n        function bindCommand(method) {\n            if (typeof method === \"string\")\n                method = commandManager[method];\n            return function () { method.apply(commandManager, arguments); }\n        }\n\n        function makeSpritedButtonRow() {\n\n            var buttonBar = panels.buttonBar;\n\n            var normalYShift = \"0px\";\n            var disabledYShift = \"-20px\";\n            var highlightYShift = \"-40px\";\n\n            var buttonRow = document.createElement(\"ul\");\n            buttonRow.id = \"wmd-button-row\" + postfix;\n            buttonRow.className = 'wmd-button-row';\n            buttonRow = buttonBar.appendChild(buttonRow);\n            var xPosition = 0;\n            var makeButton = function (id, title, XShift, textOp) {\n                var button = document.createElement(\"li\");\n                button.className = \"wmd-button\";\n                button.style.left = xPosition + \"px\";\n                xPosition += 25;\n                var buttonImage = document.createElement(\"span\");\n                button.id = id + postfix;\n                button.appendChild(buttonImage);\n                button.title = title;\n                button.XShift = XShift;\n                if (textOp)\n                    button.textOp = textOp;\n                setupButton(button, true);\n                buttonRow.appendChild(button);\n                return button;\n            };\n            var makeSpacer = function (num) {\n                var spacer = document.createElement(\"li\");\n                spacer.className = \"wmd-spacer wmd-spacer\" + num;\n                spacer.id = \"wmd-spacer\" + num + postfix;\n                buttonRow.appendChild(spacer);\n                xPosition += 25;\n            }\n\n            buttons.bold = makeButton(\"wmd-bold-button\", getStringAndKey(\"bold\"), \"0px\", bindCommand(\"doBold\"));\n            buttons.italic = makeButton(\"wmd-italic-button\", getStringAndKey(\"italic\"), \"-20px\", bindCommand(\"doItalic\"));\n            makeSpacer(1);\n            buttons.link = makeButton(\"wmd-link-button\", getStringAndKey(\"link\"), \"-40px\", bindCommand(function (chunk, postProcessing) {\n                return this.doLinkOrImage(chunk, postProcessing, false);\n            }));\n            buttons.quote = makeButton(\"wmd-quote-button\", getStringAndKey(\"quote\"), \"-60px\", bindCommand(\"doBlockquote\"));\n            buttons.code = makeButton(\"wmd-code-button\", getStringAndKey(\"code\"), \"-80px\", bindCommand(\"doCode\"));\n            buttons.image = makeButton(\"wmd-image-button\", getStringAndKey(\"image\"), \"-100px\", bindCommand(function (chunk, postProcessing) {\n                return this.doLinkOrImage(chunk, postProcessing, true);\n            }));\n            makeSpacer(2);\n            buttons.olist = makeButton(\"wmd-olist-button\", getStringAndKey(\"olist\"), \"-120px\", bindCommand(function (chunk, postProcessing) {\n                this.doList(chunk, postProcessing, true);\n            }));\n            buttons.ulist = makeButton(\"wmd-ulist-button\", getStringAndKey(\"ulist\"), \"-140px\", bindCommand(function (chunk, postProcessing) {\n                this.doList(chunk, postProcessing, false);\n            }));\n            buttons.heading = makeButton(\"wmd-heading-button\", getStringAndKey(\"heading\"), \"-160px\", bindCommand(\"doHeading\"));\n            buttons.hr = makeButton(\"wmd-hr-button\", getStringAndKey(\"hr\"), \"-180px\", bindCommand(\"doHorizontalRule\"));\n            makeSpacer(3);\n            buttons.undo = makeButton(\"wmd-undo-button\", getStringAndKey(\"undo\"), \"-200px\", null);\n            buttons.undo.execute = function (manager) { inputBox.doc.undo(); };\n\n            buttons.redo = makeButton(\"wmd-redo-button\", getStringAndKey(\"redo\"), \"-220px\", null);\n            buttons.redo.execute = function (manager) { inputBox.doc.redo(); };\n\n            if (helpOptions) {\n                var helpButton = document.createElement(\"li\");\n                var helpButtonImage = document.createElement(\"span\");\n                helpButton.appendChild(helpButtonImage);\n                helpButton.className = \"wmd-button wmd-help-button\";\n                helpButton.id = \"wmd-help-button\" + postfix;\n                helpButton.XShift = \"-240px\";\n                helpButton.isHelp = true;\n                helpButton.style.right = \"0px\";\n                helpButton.title = getString(\"help\");\n                helpButton.onclick = helpOptions.handler;\n\n                setupButton(helpButton, true);\n                buttonRow.appendChild(helpButton);\n                buttons.help = helpButton;\n            }\n\n            that.setUndoRedoButtonStates();\n            inputBox.on('change', function() {\n                that.setUndoRedoButtonStates();\n            });\n        }\n\n        this.buttons = buttons;\n        this.setButtonState = setupButton;\n\n    }\n\n    function CommandManager(pluginHooks, getString) {\n        this.hooks = pluginHooks;\n        this.getString = getString;\n    }\n\n    var commandProto = CommandManager.prototype;\n\n    // The markdown symbols - 4 spaces = code, > = blockquote, etc.\n    commandProto.prefixes = \"(?:\\\\s{4,}|\\\\s*>|\\\\s*-\\\\s+|\\\\s*\\\\d+\\\\.|=|\\\\+|-|_|\\\\*|#|\\\\s*\\\\[[^\\n]]+\\\\]:)\";\n\n    // Remove markdown symbols from the chunk selection.\n    commandProto.unwrap = function (chunk) {\n        var txt = new re(\"([^\\\\n])\\\\n(?!(\\\\n|\" + this.prefixes + \"))\", \"g\");\n        chunk.selection = chunk.selection.replace(txt, \"$1 $2\");\n    };\n\n    commandProto.wrap = function (chunk, len) {\n        this.unwrap(chunk);\n        var regex = new re(\"(.{1,\" + len + \"})( +|$\\\\n?)\", \"gm\"),\n            that = this;\n\n        chunk.selection = chunk.selection.replace(regex, function (line, marked) {\n            if (new re(\"^\" + that.prefixes, \"\").test(line)) {\n                return line;\n            }\n            return marked + \"\\n\";\n        });\n\n        chunk.selection = chunk.selection.replace(/\\s+$/, \"\");\n    };\n\n    commandProto.doBold = function (chunk, postProcessing) {\n        return this.doBorI(chunk, postProcessing, 2, this.getString(\"boldexample\"));\n    };\n\n    commandProto.doItalic = function (chunk, postProcessing) {\n        return this.doBorI(chunk, postProcessing, 1, this.getString(\"italicexample\"));\n    };\n\n    // chunk: The selected region that will be enclosed with */**\n    // nStars: 1 for italics, 2 for bold\n    // insertText: If you just click the button without highlighting text, this gets inserted\n    commandProto.doBorI = function (chunk, postProcessing, nStars, insertText) {\n\n        // Get rid of whitespace and fixup newlines.\n        chunk.trimWhitespace();\n        chunk.selection = chunk.selection.replace(/\\n{2,}/g, \"\\n\");\n\n        // Look for stars before and after.  Is the chunk already marked up?\n        // note that these regex matches cannot fail\n        var starsBefore = /(\\**$)/.exec(chunk.before)[0];\n        var starsAfter = /(^\\**)/.exec(chunk.after)[0];\n\n        var prevStars = Math.min(starsBefore.length, starsAfter.length);\n\n        // Remove stars if we have to since the button acts as a toggle.\n        if ((prevStars >= nStars) && (prevStars != 2 || nStars != 1)) {\n            chunk.before = chunk.before.replace(re(\"[*]{\" + nStars + \"}$\", \"\"), \"\");\n            chunk.after = chunk.after.replace(re(\"^[*]{\" + nStars + \"}\", \"\"), \"\");\n        }\n        else if (!chunk.selection && starsAfter) {\n            // It's not really clear why this code is necessary.  It just moves\n            // some arbitrary stuff around.\n            chunk.after = chunk.after.replace(/^([*_]*)/, \"\");\n            chunk.before = chunk.before.replace(/(\\s?)$/, \"\");\n            var whitespace = re.$1;\n            chunk.before = chunk.before + starsAfter + whitespace;\n        }\n        else {\n\n            // In most cases, if you don't have any selected text and click the button\n            // you'll get a selected, marked up region with the default text inserted.\n            if (!chunk.selection && !starsAfter) {\n                chunk.selection = insertText;\n            }\n\n            // Add the true markup.\n            var markup = nStars <= 1 ? \"*\" : \"**\"; // shouldn't the test be = ?\n            chunk.before = chunk.before + markup;\n            chunk.after = markup + chunk.after;\n        }\n\n        return;\n    };\n\n    commandProto.stripLinkDefs = function (text, defsToAdd) {\n\n        text = text.replace(/^[ ]{0,3}\\[(\\d+)\\]:[ \\t]*\\n?[ \\t]*<?(\\S+?)>?[ \\t]*\\n?[ \\t]*(?:(\\n*)[\"(](.+?)[\")][ \\t]*)?(?:\\n+|$)/gm,\n            function (totalMatch, id, link, newlines, title) {\n                defsToAdd[id] = totalMatch.replace(/\\s*$/, \"\");\n                if (newlines) {\n                    // Strip the title and return that separately.\n                    defsToAdd[id] = totalMatch.replace(/[\"(](.+?)[\")]$/, \"\");\n                    return newlines + title;\n                }\n                return \"\";\n            });\n\n        return text;\n    };\n\n    commandProto.addLinkDef = function (chunk, linkDef) {\n\n        var refNumber = 0; // The current reference number\n        var defsToAdd = {}; //\n        // Start with a clean slate by removing all previous link definitions.\n        chunk.before = this.stripLinkDefs(chunk.before, defsToAdd);\n        chunk.selection = this.stripLinkDefs(chunk.selection, defsToAdd);\n        chunk.after = this.stripLinkDefs(chunk.after, defsToAdd);\n\n        var defs = \"\";\n        var regex = /(\\[)((?:\\[[^\\]]*\\]|[^\\[\\]])*)(\\][ ]?(?:\\n[ ]*)?\\[)(\\d+)(\\])/g;\n\n        var addDefNumber = function (def) {\n            refNumber++;\n            def = def.replace(/^[ ]{0,3}\\[(\\d+)\\]:/, \"  [\" + refNumber + \"]:\");\n            defs += \"\\n\" + def;\n        };\n\n        // note that\n        // a) the recursive call to getLink cannot go infinite, because by definition\n        //    of regex, inner is always a proper substring of wholeMatch, and\n        // b) more than one level of nesting is neither supported by the regex\n        //    nor making a lot of sense (the only use case for nesting is a linked image)\n        var getLink = function (wholeMatch, before, inner, afterInner, id, end) {\n            inner = inner.replace(regex, getLink);\n            if (defsToAdd[id]) {\n                addDefNumber(defsToAdd[id]);\n                return before + inner + afterInner + refNumber + end;\n            }\n            return wholeMatch;\n        };\n\n        chunk.before = chunk.before.replace(regex, getLink);\n\n        if (linkDef) {\n            addDefNumber(linkDef);\n        }\n        else {\n            chunk.selection = chunk.selection.replace(regex, getLink);\n        }\n\n        var refOut = refNumber;\n\n        chunk.after = chunk.after.replace(regex, getLink);\n\n        if (chunk.after) {\n            chunk.after = chunk.after.replace(/\\n*$/, \"\");\n        }\n        if (!chunk.after) {\n            chunk.selection = chunk.selection.replace(/\\n*$/, \"\");\n        }\n\n        chunk.after += \"\\n\\n\" + defs;\n\n        return refOut;\n    };\n\n    // takes the line as entered into the add link/as image dialog and makes\n    // sure the URL and the optinal title are \"nice\".\n    function properlyEncoded(linkdef) {\n        return linkdef.replace(/^\\s*(.*?)(?:\\s+\"(.+)\")?\\s*$/, function (wholematch, link, title) {\n            link = link.replace(/\\?.*$/, function (querypart) {\n                return querypart.replace(/\\+/g, \" \"); // in the query string, a plus and a space are identical\n            });\n            link = decodeURIComponent(link); // unencode first, to prevent double encoding\n            link = encodeURI(link).replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29');\n            link = link.replace(/\\?.*$/, function (querypart) {\n                return querypart.replace(/\\+/g, \"%2b\"); // since we replaced plus with spaces in the query part, all pluses that now appear where originally encoded\n            });\n            if (title) {\n                title = title.trim ? title.trim() : title.replace(/^\\s*/, \"\").replace(/\\s*$/, \"\");\n                title = title.replace(/\"/g, \"quot;\").replace(/\\(/g, \"&#40;\").replace(/\\)/g, \"&#41;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n            }\n            return title ? link + ' \"' + title + '\"' : link;\n        });\n    }\n\n    commandProto.doLinkOrImage = function (chunk, postProcessing, isImage) {\n\n        chunk.trimWhitespace();\n        chunk.findTags(/\\s*!?\\[/, /\\][ ]?(?:\\n[ ]*)?(\\[.*?\\])?/);\n        var background;\n\n        if (chunk.endTag.length > 1 && chunk.startTag.length > 0) {\n\n            chunk.startTag = chunk.startTag.replace(/!?\\[/, \"\");\n            chunk.endTag = \"\";\n            this.addLinkDef(chunk, null);\n\n        }\n        else {\n            \n            // We're moving start and end tag back into the selection, since (as we're in the else block) we're not\n            // *removing* a link, but *adding* one, so whatever findTags() found is now back to being part of the\n            // link text. linkEnteredCallback takes care of escaping any brackets.\n            chunk.selection = chunk.startTag + chunk.selection + chunk.endTag;\n            chunk.startTag = chunk.endTag = \"\";\n\n            if (/\\n\\n/.test(chunk.selection)) {\n                this.addLinkDef(chunk, null);\n                return;\n            }\n            var that = this;\n            // The function to be executed when you enter a link and press OK or Cancel.\n            // Marks up the link and adds the ref.\n            var linkEnteredCallback = function (link) {\n\n                background.parentNode.removeChild(background);\n\n                if (link !== null) {\n                    // (                          $1\n                    //     [^\\\\]                  anything that's not a backslash\n                    //     (?:\\\\\\\\)*              an even number (this includes zero) of backslashes\n                    // )\n                    // (?=                        followed by\n                    //     [[\\]]                  an opening or closing bracket\n                    // )\n                    //\n                    // In other words, a non-escaped bracket. These have to be escaped now to make sure they\n                    // don't count as the end of the link or similar.\n                    // Note that the actual bracket has to be a lookahead, because (in case of to subsequent brackets),\n                    // the bracket in one match may be the \"not a backslash\" character in the next match, so it\n                    // should not be consumed by the first match.\n                    // The \"prepend a space and finally remove it\" steps makes sure there is a \"not a backslash\" at the\n                    // start of the string, so this also works if the selection begins with a bracket. We cannot solve\n                    // this by anchoring with ^, because in the case that the selection starts with two brackets, this\n                    // would mean a zero-width match at the start. Since zero-width matches advance the string position,\n                    // the first bracket could then not act as the \"not a backslash\" for the second.\n                    chunk.selection = (\" \" + chunk.selection).replace(/([^\\\\](?:\\\\\\\\)*)(?=[[\\]])/g, \"$1\\\\\").substr(1);\n                    \n                    var linkDef = \" [999]: \" + properlyEncoded(link);\n\n                    var num = that.addLinkDef(chunk, linkDef);\n                    chunk.startTag = isImage ? \"![\" : \"[\";\n                    chunk.endTag = \"][\" + num + \"]\";\n\n                    if (!chunk.selection) {\n                        if (isImage) {\n                            chunk.selection = that.getString(\"imagedescription\");\n                        }\n                        else {\n                            chunk.selection = that.getString(\"linkdescription\");\n                        }\n                    }\n                }\n                postProcessing();\n            };\n\n            background = ui.createBackground();\n\n            if (isImage) {\n                if (!this.hooks.insertImageDialog(linkEnteredCallback))\n                    ui.prompt(this.getString(\"imagedialog\"), imageDefaultText, linkEnteredCallback);\n            }\n            else {\n                if (!this.hooks.insertLinkDialog(linkEnteredCallback))\n                    ui.prompt(this.getString(\"linkdialog\"), linkDefaultText, linkEnteredCallback);\n            }\n            return true;\n        }\n    };\n\n    // When making a list, hitting shift-enter will put your cursor on the next line\n    // at the current indent level.\n    commandProto.doAutoindent = function (chunk, postProcessing) {\n\n        var commandMgr = this,\n            fakeSelection = false;\n\n        chunk.before = chunk.before.replace(/(\\n|^)[ ]{0,3}([*+-]|\\d+[.])[ \\t]*\\n$/, \"\\n\\n\");\n        chunk.before = chunk.before.replace(/(\\n|^)[ ]{0,3}>[ \\t]*\\n$/, \"\\n\\n\");\n        chunk.before = chunk.before.replace(/(\\n|^)[ \\t]+\\n$/, \"\\n\\n\");\n        \n        // There's no selection, end the cursor wasn't at the end of the line:\n        // The user wants to split the current list item / code line / blockquote line\n        // (for the latter it doesn't really matter) in two. Temporarily select the\n        // (rest of the) line to achieve this.\n        if (!chunk.selection && !/^[ \\t]*(?:\\n|$)/.test(chunk.after)) {\n            chunk.after = chunk.after.replace(/^[^\\n]*/, function (wholeMatch) {\n                chunk.selection = wholeMatch;\n                return \"\";\n            });\n            fakeSelection = true;\n        }\n\n        if (/(\\n|^)[ ]{0,3}([*+-]|\\d+[.])[ \\t]+.*\\n$/.test(chunk.before)) {\n            if (commandMgr.doList) {\n                commandMgr.doList(chunk);\n            }\n        }\n        if (/(\\n|^)[ ]{0,3}>[ \\t]+.*\\n$/.test(chunk.before)) {\n            if (commandMgr.doBlockquote) {\n                commandMgr.doBlockquote(chunk);\n            }\n        }\n        if (/(\\n|^)(\\t|[ ]{4,}).*\\n$/.test(chunk.before)) {\n            if (commandMgr.doCode) {\n                commandMgr.doCode(chunk);\n            }\n        }\n        \n        if (fakeSelection) {\n            chunk.after = chunk.selection + chunk.after;\n            chunk.selection = \"\";\n        }\n    };\n\n    commandProto.doBlockquote = function (chunk, postProcessing) {\n\n        chunk.selection = chunk.selection.replace(/^(\\n*)([^\\r]+?)(\\n*)$/,\n            function (totalMatch, newlinesBefore, text, newlinesAfter) {\n                chunk.before += newlinesBefore;\n                chunk.after = newlinesAfter + chunk.after;\n                return text;\n            });\n\n        chunk.before = chunk.before.replace(/(>[ \\t]*)$/,\n            function (totalMatch, blankLine) {\n                chunk.selection = blankLine + chunk.selection;\n                return \"\";\n            });\n\n        chunk.selection = chunk.selection.replace(/^(\\s|>)+$/, \"\");\n        chunk.selection = chunk.selection || this.getString(\"quoteexample\");\n\n        // The original code uses a regular expression to find out how much of the\n        // text *directly before* the selection already was a blockquote:\n\n        /*\n        if (chunk.before) {\n        chunk.before = chunk.before.replace(/\\n?$/, \"\\n\");\n        }\n        chunk.before = chunk.before.replace(/(((\\n|^)(\\n[ \\t]*)*>(.+\\n)*.*)+(\\n[ \\t]*)*$)/,\n        function (totalMatch) {\n        chunk.startTag = totalMatch;\n        return \"\";\n        });\n        */\n\n        // This comes down to:\n        // Go backwards as many lines a possible, such that each line\n        //  a) starts with \">\", or\n        //  b) is almost empty, except for whitespace, or\n        //  c) is preceeded by an unbroken chain of non-empty lines\n        //     leading up to a line that starts with \">\" and at least one more character\n        // and in addition\n        //  d) at least one line fulfills a)\n        //\n        // Since this is essentially a backwards-moving regex, it's susceptible to\n        // catstrophic backtracking and can cause the browser to hang;\n        // see e.g. http://meta.stackoverflow.com/questions/9807.\n        //\n        // Hence we replaced this by a simple state machine that just goes through the\n        // lines and checks for a), b), and c).\n\n        var match = \"\",\n            leftOver = \"\",\n            line;\n        if (chunk.before) {\n            var lines = chunk.before.replace(/\\n$/, \"\").split(\"\\n\");\n            var inChain = false;\n            for (var i = 0; i < lines.length; i++) {\n                var good = false;\n                line = lines[i];\n                inChain = inChain && line.length > 0; // c) any non-empty line continues the chain\n                if (/^>/.test(line)) {                // a)\n                    good = true;\n                    if (!inChain && line.length > 1)  // c) any line that starts with \">\" and has at least one more character starts the chain\n                        inChain = true;\n                } else if (/^[ \\t]*$/.test(line)) {   // b)\n                    good = true;\n                } else {\n                    good = inChain;                   // c) the line is not empty and does not start with \">\", so it matches if and only if we're in the chain\n                }\n                if (good) {\n                    match += line + \"\\n\";\n                } else {\n                    leftOver += match + line;\n                    match = \"\\n\";\n                }\n            }\n            if (!/(^|\\n)>/.test(match)) {             // d)\n                leftOver += match;\n                match = \"\";\n            }\n        }\n\n        chunk.startTag = match;\n        chunk.before = leftOver;\n\n        // end of change\n\n        /*benweet Don't really know the purpose of it but it is destructive\n        \n        if (chunk.after) {\n            chunk.after = chunk.after.replace(/^\\n?/, \"\\n\");\n        }\n\n        chunk.after = chunk.after.replace(/^(((\\n|^)(\\n[ \\t]*)*>(.+\\n)*.*)+(\\n[ \\t]*)*)/,\n            function (totalMatch) {\n                chunk.endTag = totalMatch;\n                return \"\";\n            }\n        );\n        */\n\n        var replaceBlanksInTags = function (useBracket) {\n\n            var replacement = useBracket ? \"> \" : \"\";\n\n            if (chunk.startTag) {\n                chunk.startTag = chunk.startTag.replace(/\\n((>|\\s)*)\\n$/,\n                    function (totalMatch, markdown) {\n                        return \"\\n\" + markdown.replace(/^[ ]{0,3}>?[ \\t]*$/gm, replacement) + \"\\n\";\n                    });\n            }\n            if (chunk.endTag) {\n                chunk.endTag = chunk.endTag.replace(/^\\n((>|\\s)*)\\n/,\n                    function (totalMatch, markdown) {\n                        return \"\\n\" + markdown.replace(/^[ ]{0,3}>?[ \\t]*$/gm, replacement) + \"\\n\";\n                    });\n            }\n        };\n\n        if (/^(?![ ]{0,3}>)/m.test(chunk.selection)) {\n            this.wrap(chunk, SETTINGS.lineLength - 2);\n            chunk.selection = chunk.selection.replace(/^/gm, \"> \");\n            replaceBlanksInTags(true);\n            chunk.skipLines();\n        } else {\n            chunk.selection = chunk.selection.replace(/^[ ]{0,3}> ?/gm, \"\");\n            this.unwrap(chunk);\n            replaceBlanksInTags(false);\n\n            if (!/^(\\n|^)[ ]{0,3}>/.test(chunk.selection) && chunk.startTag) {\n                chunk.startTag = chunk.startTag.replace(/\\n{0,2}$/, \"\\n\\n\");\n            }\n\n            if (!/(\\n|^)[ ]{0,3}>.*$/.test(chunk.selection) && chunk.endTag) {\n                chunk.endTag = chunk.endTag.replace(/^\\n{0,2}/, \"\\n\\n\");\n            }\n        }\n\n        chunk.selection = this.hooks.postBlockquoteCreation(chunk.selection);\n\n        if (!/\\n/.test(chunk.selection)) {\n            chunk.selection = chunk.selection.replace(/^(> *)/,\n            function (wholeMatch, blanks) {\n                chunk.startTag += blanks;\n                return \"\";\n            });\n        }\n    };\n\n    commandProto.doCode = function (chunk, postProcessing) {\n\n        var hasTextBefore = /\\S[ ]*$/.test(chunk.before);\n        var hasTextAfter = /^[ ]*\\S/.test(chunk.after);\n\n        // Use 'four space' markdown if the selection is on its own\n        // line or is multiline.\n        if ((!hasTextAfter && !hasTextBefore) || /\\n/.test(chunk.selection)) {\n\n            chunk.before = chunk.before.replace(/[ ]{4}$/,\n                function (totalMatch) {\n                    chunk.selection = totalMatch + chunk.selection;\n                    return \"\";\n                });\n\n            var nLinesBack = 1;\n            var nLinesForward = 1;\n\n            if (/(\\n|^)(\\t|[ ]{4,}).*\\n$/.test(chunk.before)) {\n                nLinesBack = 0;\n            }\n            if (/^\\n(\\t|[ ]{4,})/.test(chunk.after)) {\n                nLinesForward = 0;\n            }\n\n            chunk.skipLines(nLinesBack, nLinesForward);\n\n            if (!chunk.selection) {\n                chunk.startTag = \"    \";\n                chunk.selection = this.getString(\"codeexample\");\n            }\n            else {\n                if (/^[ ]{0,3}\\S/m.test(chunk.selection)) {\n                    if (/\\n/.test(chunk.selection))\n                        chunk.selection = chunk.selection.replace(/^/gm, \"    \");\n                    else // if it's not multiline, do not select the four added spaces; this is more consistent with the doList behavior\n                        chunk.before += \"    \";\n                }\n                else {\n                    chunk.selection = chunk.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\\t)/gm, \"\");\n                }\n            }\n        }\n        else {\n            // Use backticks (`) to delimit the code block.\n\n            chunk.trimWhitespace();\n            chunk.findTags(/`/, /`/);\n\n            if (!chunk.startTag && !chunk.endTag) {\n                chunk.startTag = chunk.endTag = \"`\";\n                if (!chunk.selection) {\n                    chunk.selection = this.getString(\"codeexample\");\n                }\n            }\n            else if (chunk.endTag && !chunk.startTag) {\n                chunk.before += chunk.endTag;\n                chunk.endTag = \"\";\n            }\n            else {\n                chunk.startTag = chunk.endTag = \"\";\n            }\n        }\n    };\n\n    commandProto.doList = function (chunk, postProcessing, isNumberedList) {\n\n        // These are identical except at the very beginning and end.\n        // Should probably use the regex extension function to make this clearer.\n        var previousItemsRegex = /(\\n|^)(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+.*)(\\n.+|\\n{2,}([*+-].*|\\d+[.])[ \\t]+.*|\\n{2,}[ \\t]+\\S.*)*)\\n*$/;\n        var nextItemsRegex = /^\\n*(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+.*)(\\n.+|\\n{2,}([*+-].*|\\d+[.])[ \\t]+.*|\\n{2,}[ \\t]+\\S.*)*)\\n*/;\n\n        // The default bullet is a dash but others are possible.\n        // This has nothing to do with the particular HTML bullet,\n        // it's just a markdown bullet.\n        var bullet = \"-\";\n\n        // The number in a numbered list.\n        var num = 1;\n\n        // Get the item prefix - e.g. \" 1. \" for a numbered list, \" - \" for a bulleted list.\n        var getItemPrefix = function () {\n            var prefix;\n            if (isNumberedList) {\n                prefix = \" \" + num + \". \";\n                num++;\n            }\n            else {\n                prefix = \" \" + bullet + \" \";\n            }\n            return prefix;\n        };\n\n        // Fixes the prefixes of the other list items.\n        var getPrefixedItem = function (itemText) {\n\n            // The numbering flag is unset when called by autoindent.\n            if (isNumberedList === undefined) {\n                isNumberedList = /^\\s*\\d/.test(itemText);\n            }\n\n            // Renumber/bullet the list element.\n            itemText = itemText.replace(/^[ ]{0,3}([*+-]|\\d+[.])\\s/gm,\n                function (_) {\n                    return getItemPrefix();\n                });\n\n            return itemText;\n        };\n\n        chunk.findTags(/(\\n|^)*[ ]{0,3}([*+-]|\\d+[.])\\s+/, null);\n\n        if (chunk.before && !/\\n$/.test(chunk.before) && !/^\\n/.test(chunk.startTag)) {\n            chunk.before += chunk.startTag;\n            chunk.startTag = \"\";\n        }\n\n        if (chunk.startTag) {\n\n            var hasDigits = /\\d+[.]/.test(chunk.startTag);\n            chunk.startTag = \"\";\n            chunk.selection = chunk.selection.replace(/\\n[ ]{4}/g, \"\\n\");\n            this.unwrap(chunk);\n            chunk.skipLines();\n\n            if (hasDigits) {\n                // Have to renumber the bullet points if this is a numbered list.\n                chunk.after = chunk.after.replace(nextItemsRegex, getPrefixedItem);\n            }\n            if (isNumberedList == hasDigits) {\n                return;\n            }\n        }\n\n        var nLinesUp = 1;\n\n        chunk.before = chunk.before.replace(previousItemsRegex,\n            function (itemText) {\n                if (/^\\s*([*+-])/.test(itemText)) {\n                    bullet = re.$1;\n                }\n                nLinesUp = /[^\\n]\\n\\n[^\\n]/.test(itemText) ? 1 : 0;\n                return getPrefixedItem(itemText);\n            });\n\n        if (!chunk.selection) {\n            chunk.selection = this.getString(\"litem\");\n        }\n\n        var prefix = getItemPrefix();\n\n        var nLinesDown = 1;\n\n        chunk.after = chunk.after.replace(nextItemsRegex,\n            function (itemText) {\n                nLinesDown = /[^\\n]\\n\\n[^\\n]/.test(itemText) ? 1 : 0;\n                return getPrefixedItem(itemText);\n            });\n\n        chunk.trimWhitespace(true);\n        chunk.skipLines(nLinesUp, nLinesDown, true);\n        chunk.startTag = prefix;\n        var spaces = prefix.replace(/./g, \" \");\n        this.wrap(chunk, SETTINGS.lineLength - spaces.length);\n        chunk.selection = chunk.selection.replace(/\\n/g, \"\\n\" + spaces);\n\n    };\n\n    commandProto.doHeading = function (chunk, postProcessing) {\n\n        // Remove leading/trailing whitespace and reduce internal spaces to single spaces.\n        chunk.selection = chunk.selection.replace(/\\s+/g, \" \");\n        chunk.selection = chunk.selection.replace(/(^\\s+|\\s+$)/g, \"\");\n\n        // If we clicked the button with no selected text, we just\n        // make a level 2 hash header around some default text.\n        if (!chunk.selection) {\n            chunk.startTag = \"## \";\n            chunk.selection = this.getString(\"headingexample\");\n            chunk.endTag = \" ##\";\n            return;\n        }\n\n        var headerLevel = 0;     // The existing header level of the selected text.\n\n        // Remove any existing hash heading markdown and save the header level.\n        chunk.findTags(/#+[ ]*/, /[ ]*#+/);\n        if (/#+/.test(chunk.startTag)) {\n            headerLevel = re.lastMatch.length;\n        }\n        chunk.startTag = chunk.endTag = \"\";\n\n        // Try to get the current header level by looking for - and = in the line\n        // below the selection.\n        chunk.findTags(null, /\\s?(-+|=+)/);\n        if (/=+/.test(chunk.endTag)) {\n            headerLevel = 1;\n        }\n        if (/-+/.test(chunk.endTag)) {\n            headerLevel = 2;\n        }\n\n        // Skip to the next line so we can create the header markdown.\n        chunk.startTag = chunk.endTag = \"\";\n        chunk.skipLines(1, 1);\n\n        // We make a level 2 header if there is no current header.\n        // If there is a header level, we substract one from the header level.\n        // If it's already a level 1 header, it's removed.\n        var headerLevelToCreate = headerLevel == 0 ? 2 : headerLevel - 1;\n\n        if (headerLevelToCreate > 0) {\n\n            // The button only creates level 1 and 2 underline headers.\n            // Why not have it iterate over hash header levels?  Wouldn't that be easier and cleaner?\n            var headerChar = headerLevelToCreate >= 2 ? \"-\" : \"=\";\n            var len = chunk.selection.length;\n            if (len > SETTINGS.lineLength) {\n                len = SETTINGS.lineLength;\n            }\n            chunk.endTag = \"\\n\";\n            while (len--) {\n                chunk.endTag += headerChar;\n            }\n        }\n    };\n\n    commandProto.doHorizontalRule = function (chunk, postProcessing) {\n        chunk.startTag = \"----------\\n\";\n        chunk.selection = \"\";\n        chunk.skipLines(2, 1, true);\n    }\n\n})();\n\nexport default Markdown\n","import React, { Component, createRef } from 'react'\nimport styled from 'styled-components'\n\nimport { connect } from 'react-redux'\nimport { setCmInstance } from '../../actions/editorActions'\n\nimport { default as PagedownConverter } from '../../vendor/Markdown.Converter'\nimport { default as PagedownEditor } from '../../vendor/Markdown.Editor'\n\nimport CodeMirror from 'codemirror'\nimport 'codemirror/mode/gfm/gfm'\nimport 'codemirror/mode/javascript/javascript'\nimport 'codemirror/mode/css/css'\nimport 'codemirror/mode/clike/clike'\nimport '../../static/css/CodeMirrorStyle.css'\n\nconst FakeButtonsElement = styled.div`\n\tposition: absolute;\n\theight: 0;\n\twidth: 0;\n\toverflow: hidden;\n`\n\nclass Editor extends Component {\n\teditorRef = createRef()\n\n\tcomponentDidMount() {\n\t\tconst pagedownConverter = new PagedownConverter.Converter()\n\t\tconst pagedownEditor = new PagedownEditor.Editor(pagedownConverter)\n\t\tconst codeMirror = CodeMirror.fromTextArea(this.editorRef.current, {\n\t\t\tvalue: '',\n\t\t\tmode: {\n\t\t\t\tname: 'markdown',\n\t\t\t\tallowAtxHeaderWithoutSpace: true,\n\t\t\t\thighlightFormatting: true,\n\t\t\t\tmaxBlockquoteDepth: 3,\n\t\t\t\tfencedCodeBlockHighlighting: true,\n\t\t\t},\n\t\t\tlineWrapping: true,\n\t\t})\n\t\tpagedownEditor.run(codeMirror)\n\t\tconst doClick = name =>\n\t\t\tpagedownEditor.uiManager.buttons[name] && pagedownEditor.uiManager.buttons[name].onclick()\n\t\tthis.props.setCmInstance({ codeMirror, doClick })\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<FakeButtonsElement id=\"wmd-button-bar\" />\n\t\t\t\t<textarea ref={this.editorRef} />\n\t\t\t</>\n\t\t)\n\t}\n}\n\nconst mapDispatchToProps = { setCmInstance }\n\nexport default connect(\n\tnull,\n\tmapDispatchToProps\n)(Editor)\n","import React from 'react'\nimport styled from 'styled-components'\nimport Editor from '../Editor/Editor'\n\nconst Wrapper = styled.div`\n    width: 100%;\n    display: flex;\n    justify-content: center;\n`\n\nconst StyledPaper = styled.div`\n\tmargin-top: 40px;\n\twidth: calc(var(--container-width) - 60px);\n\tpadding: 30px;\n\tbackground-color: white;\n\tbox-shadow: 10px 20px 20px rgba(0, 0, 0, .25);\n`\n\nconst Paper = () => (\n    <Wrapper>\n        <StyledPaper>\n            <Editor />\n        </StyledPaper>\n    </Wrapper>\n)\n\nexport default Paper\n","import React from 'react'\nimport { createGlobalStyle } from 'styled-components'\nimport Toolbar from '../Toolbar/Toolbar'\nimport Sidebar from '../Sidebar/Sidebar'\nimport Paper from '../Paper/Paper'\n\nconst GlobalStyle = createGlobalStyle`\n\t* {\n        margin: 0;\n        padding: 0;\n\t}\n    body {\n        font-family: Roboto;\n\t\tbackground-color: var(--c-lightgrey-bg);\n\t\tpadding-top: 60px;\n    }\n    :root {\n        font-size: 18px;\n\n\t\t--container-width: 1200px;\n\t\t--max-width: 1700px;\n\t\n        --c-lightgrey-bg: #eee;\n\t\t--c-darkgrey-bg: #3E3E3E;\n\t\t--c-white-hl: rgba(255, 255, 255, 0.65);\n\t\t--c-blue-hl: #00B2FF;\n        --c-lightgrey-text: #eee;\n\t\t--c-grey-text: #B9B9B9;\n\t\t--c-darkgrey-text: #555;\n\n\t\t@media (max-width: 1920px) {\n\t\t\t--container-width: 60vw;\n\t\t\t--max-width: calc(60vw + 500px);\n\t\t}\n\t\t@media (max-width: 1680px) {\n\t\t\t--container-width: 70vw;\n\t\t\t--max-width: 100vw;\n\t\t}\n    }\n`\n\nconst App = () => (\n\t<div>\n\t\t<Toolbar />\n        <Sidebar />\n        <Paper />\n\t\t<GlobalStyle />\n\t</div>\n)\n\nexport default App\n","import React from 'react'\nimport { render } from 'react-dom'\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport { Provider } from 'react-redux'\nimport thunkMiddleware from 'redux-thunk'\nimport registerServiceWorker from './registerServiceWorker'\nimport rootReducer from './reducers'\n\nimport App from './components/App/App'\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\nconst store = createStore(rootReducer, composeEnhancers(applyMiddleware(thunkMiddleware)\n));\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n);\n\nregisterServiceWorker()\n"],"sourceRoot":""}